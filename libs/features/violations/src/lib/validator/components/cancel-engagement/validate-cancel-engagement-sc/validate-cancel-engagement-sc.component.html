<!--
  ~ Copyright GOSI. All Rights Reserved.
  ~  This software is the proprietary information of GOSI.
  ~  Use is subject to license terms.
  -->

<gosi-breadcrumb-dc></gosi-breadcrumb-dc>

<div class="content">
  <frm-main-content-dc [canEdit]="false" [documents]="documents ? documents : []" [comments]="transactionReferenceData">
    <div id="mainHeading">
      <frm-main-heading-dc
        [heading]="'VIOLATIONS.REPORT-VIOLATION' | translate"
        [transactionRefNo]="transactionDetails?.referenceNo"
      ></frm-main-heading-dc>
    </div>

    <div id="contentArea">
      <vol-validator-violations-details-dc
        [isCancelEngagement]="true"
        [parentForm]="cancelEngagementForm"
        [booleanList]="yesOrNoList$ | async"
        [transactionDetails]="transactionDetails"
        [assigneeIndex]="assigneeIndex"
        [assigneeId]="assigneeId"
        [isReturn]="isReturn"
        [isRaiseVioFoVcm]="isRaiseVioFoVcm"
        (navigateToTrasaction)="navigateToTracker($event)"
      ></vol-validator-violations-details-dc>

      <vol-validator-establishment-details-dc
        [transactionDetails]="transactionDetails"
        (estProfile)="navigateToEstProfile($event)"
        (viewPreviousForEstablishmentViolations)="showPopupForEstablishmentViolations()"
      ></vol-validator-establishment-details-dc>

      <vol-inspection-details-dc [transactionDetails]="transactionDetails" [isRaiseVioFoVcm]="isRaiseVioFoVcm">
      </vol-inspection-details-dc>

      <vol-contributor-details-dc
        [isCancelEngagement]="true"
        [transactionDetails]="transactionDetails"
        [booleanList]="yesOrNoList$ | async"
        [parentForm]="cancelEngagementForm"
        (navigate)="navigateToProfile($event)"
        (navigateToTrasaction)="navigateToTracker($event)"
        [assigneeIndex]="assigneeIndex"
        [assignedRole]="assignedRole"
        [isReturn]="isReturn"
        [isRaiseVioFoVcm]="isRaiseVioFoVcm"
        [contributorsTier]="contributorsTier"
        (isSameLength)="getClassViolations($event)"
        (viewPreviousViolations)="showPopupViolations($event)"
        (contributorSaved)="contributorSaved($event)"
        (navigateToViolation)="openViolationProfile($event)"
      >
      </vol-contributor-details-dc>

      <vol-penality-calculation-details-dc
        [transactionDetails]="transactionDetails"
        [penaltyInfoDetails]="penaltyInfoDetails"
        [penaltyArrayLen]="penaltyArrayLen"
        [violationClassList]="violationClassList"
        [parentForm]="cancelEngagementForm"
        [assignedRole]="assignedRole"
        [assigneeId]="assigneeId"
        [showVcAlert]="showVcAlert"
        [assigneeName]="assigneeName"
        [isReturn]="isReturn"
        [assigneeIndex]="assigneeIndex"
        [allExcluded]="allExcluded"
        [notAllExcluded]="notallExcluded"
        [penaltyCalculationResponse]="penaltyCalculationResponse"
        (classValue)="getClassValue($event)"
        [autoTierClass]="autoTierClass"
        [saveContributorButtonClicked]="saveContributorButtonClicked"
        [isCancelEngagement]="true"
        (excludeContributor)="navigateToExcludeContributorPage($event)"
        (penalityDetails)="getPenaltyDetails($event)"
        (isExcluded)="getViolationClassList($event)"
      ></vol-penality-calculation-details-dc>
    </div>

    <!-- Action area -->
    <div id="actionArea" *ngIf="!isButtonApprove">
      <frm-action-area-dc
        [canReject]="false"
        [canApprove]="!(billBatchInProgress && canReturn)"
        [canReturn]="canReturn"
        [isReturn]="false"
        (approveEvent)="showModal(approveTemplate, true)"
        (cancelEvent)="showModal(cancelTemplate, false)"
        (returnEvent)="showModal(returnTemplate, false)"
      >
      </frm-action-area-dc>
    </div>
  </frm-main-content-dc>
</div>

<!------------------------  Modals ----------------------------->

<ng-template #approveTemplate>
  <frm-approve-template-dc
    [parentForm]="cancelEngagementForm"
    (cancelEvent)="hideModal()"
    (approveEvent)="manageWorkflowEvents(0)"
  ></frm-approve-template-dc>
</ng-template>

<ng-template #returnTemplate>
  <frm-return-template-dc
    (cancelEvent)="hideModal()"
    [parentForm]="validatorMemberForm"
    [returnReasonList$]="returnReasonList$"
    (returnEvent)="manageWorkflowEvents(2)"
    [heading]="'CORE.RETURN-REASON'"
  >
  </frm-return-template-dc>
</ng-template>

<ng-template #cancelTemplate>
  <gosi-confirm-modal-dc [message]="'VIOLATIONS.INFO-CANCEL'" (onCancel)="hideModal()" (onConfirm)="confirmCancel()">
  </gosi-confirm-modal-dc>
</ng-template>
