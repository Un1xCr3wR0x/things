<!--
  ~ Copyright GOSI. All Rights Reserved.
  ~  This software is the proprietary information of GOSI.
  ~  Use is subject to license terms.
  -->

<div class="content">
  <div class="row mx-3 heading-row">
    <div class="heading-prop">
      {{ heading | bilingualText | titlecase }}
    </div>
    <span class="mx-2"></span>
    <div class="claimBtn btn-section" *ngIf="isUnclaimed">
      <gosi-button-dc type="primary" (click)="claimTask()">{{ 'CONTRIBUTOR.ASSIGN' | translate }}</gosi-button-dc>
    </div>
    <fa-icon class="icon-value" id="task.taskId" *ngIf="!isUnclaimed" icon="clock"></fa-icon>
    <div class="head-value d-flex justify-content-end mt-3 ml-2" *ngIf="!isUnclaimed">
      {{ 'CONTRIBUTOR.AUTO-RELEASE' | translate | uppercase }}
      <span class="ml-3" style="margin-top: -0.4rem">
        <gosi-timer-dc [isStyle]="true" [min]="minDiff" [sec]="seconds"> </gosi-timer-dc>
      </span>
    </div>
    <div class="releaseBtn btn-section ml-3" *ngIf="!isUnclaimed">
      <gosi-button-dc type="primary" (click)="release()">{{ 'CONTRIBUTOR.RELEASE' | translate }}</gosi-button-dc>
    </div>
  </div>
  <gosi-alert-sc class="alertspace"></gosi-alert-sc>
  <gosi-alert-dc [alert]="penaltyInfo"></gosi-alert-dc>

  <cnt-contributor-banner-dc *ngIf="contributor" [contributor]="contributor"></cnt-contributor-banner-dc>
  <div class="row mt-4" *ngIf="transactionRefData">
    <div class="col-12">
      <gosi-comments-dc *ngIf="transactionRefData.length > 0" [comments]="transactionRefData"> </gosi-comments-dc>
    </div>
  </div>

  <div class="card mt-4">
    <div class="card-body">
      <div class="row m-0">
        <div class="card-heading custom-heading-padding">
          <div>
            {{ 'CONTRIBUTOR.NEW-ENGAGEMENT-DETAILS' | translate }}
          </div>
        </div>
      </div>
      <!-- <cnt-establishment-details-dc
          *ngIf="establishmentDetails && registrationNumber"
          [establishmentDetails]="establishmentDetails"
          [registrationNumber]="registrationNumber"
          [isModifyCoverage]="false"
        ></cnt-establishment-details-dc> -->

      <!-- engagement details section -->
      <div class="row">
        <!-- start date -->
        <div class="col-lg-4" *ngIf="changeEngData?.joiningDate?.gregorian || changeEngData?.joiningDate?.hijiri">
          <gosi-label-dc
            id="'joiningDate'"
            [control]="changeEngData?.joiningDate | dateType"
            [label]="'CONTRIBUTOR.JOINING-DATE' | translate"
          ></gosi-label-dc>
        </div>
        <!-- Leaving Date -->
        <div class="col-lg-4" *ngIf="changeEngData?.leavingDate?.gregorian || changeEngData?.leavingDate?.hijiri">
          <gosi-label-dc
            id="leavingDate"
            [control]="changeEngData?.leavingDate | dateType"
            [label]="'CONTRIBUTOR.LEAVING' | translate"
          ></gosi-label-dc>
        </div>
        <!-- Leaving Reason -->
        <div class="col-lg-4" *ngIf="changeEngData?.leavingReason">
          <gosi-label-dc
            id="leavingReason"
            [control]="changeEngData?.leavingReason"
            [label]="'CONTRIBUTOR.LEAVE-REASON' | translate"
          >
          </gosi-label-dc>
        </div>
        <!-- cancellation Reason -->
        <!-- <div class="col-lg-4" *ngIf="cancelEngData?.cancellationReason">
            <gosi-label-dc
              id="cancelReason"
              [control]="cancelEngData?.cancellationReason"
              [label]="'CONTRIBUTOR.CANCEL-CON.CANCELLATION-REASON' | translate"
            >
            </gosi-label-dc>
          </div> -->
      </div>

      <div class="desktop-table">
        <div class="row mt-4" *ngIf="wageDetails.length > 0">
          <div class="col-md-12">
            <span class="sub-heading"> {{ 'CONTRIBUTOR.WAGE-BREAKDOWN' | translate }}</span>
            <div class="row mt-4">
              <table class="table table-wage row_separate table-responsive">
                <thead class="header">
                  <tr>
                    <!-- <th class="custom-font wage-border-radius" style="width: 16.6%">
                          {{ 'CONTRIBUTOR.OCCUPATION' | translate }}
                        </th> -->
                    <th style="width: 20%">
                      {{ 'CONTRIBUTOR.ENGAGEMENT-PERIOD' | translate }}
                    </th>
                    <th>{{ 'CONTRIBUTOR.BASIC-WAGE' | translate }}</th>
                    <th>
                      {{ 'CONTRIBUTOR.HOUSING-BENEFITS' | translate }}
                    </th>

                    <th>{{ 'CONTRIBUTOR.COMMISSIONS' | translate }}</th>
                    <th>
                      {{ 'CONTRIBUTOR.OTHER-ALLOWANCE' | translate }}
                    </th>
                    <th>{{ 'CONTRIBUTOR.TOTAL-WAGE' | translate }}</th>
                    <th>
                      {{ 'CONTRIBUTOR.JOB-CLASS' | translate }}
                    </th>
                    <th>{{ 'CONTRIBUTOR.RANK' | translate }}</th>
                    <th>{{ 'CONTRIBUTOR.GRADE' | translate }}</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody class="value-font">
                  <ng-container>
                    <tr *ngFor="let newWage of wageDetails">
                      <!-- <td>{{ activeEngagementsList[0].engagementPeriod[0]?.occupation | bilingualText }}</td> -->
                      <td>
                        {{ newWage?.startDate | dateType }}
                        <span class="pl-1 pr-2"
                          ><fa-icon [icon]="currentLang === 'ar' ? 'arrow-left' : 'arrow-right'"></fa-icon
                        ></span>
                        <span
                          ><ng-container
                            *ngIf="newWage?.endDate?.gregorian || newWage?.endDate?.hijiri; else onwards"
                            >{{ newWage?.endDate | dateType }}</ng-container
                          ></span
                        >
                      </td>
                      <td>{{ newWage?.wage?.basicWage | number: '1.2-2' }}</td>
                      <td>
                        {{
                          isPPA &&
                          ((newWage?.wage?.housingBenefit | number) === '0' || newWage?.wage?.housingBenefit === null)
                            ? '-'
                            : (newWage?.wage?.housingBenefit | number: '1.2-2')
                        }}
                      </td>
                      <td>
                        {{
                          isPPA && ((newWage?.wage?.commission | number) === '0' || newWage?.wage?.commission === null)
                            ? '-'
                            : (newWage?.wage?.commission | number: '1.2-2')
                        }}
                      </td>
                      <td>
                        {{
                          isPPA &&
                          ((newWage?.wage?.otherAllowance | number) === '0' || newWage?.wage?.otherAllowance === null)
                            ? '-'
                            : (newWage?.wage?.otherAllowance | number: '1.2-2')
                        }}
                      </td>
                      <td>
                        {{ newWage?.wage?.totalWage | number: '1.2-2' }}
                      </td>
                      <td>
                        {{ newWage?.jobClassName | bilingualText }}
                      </td>
                      <td>
                        {{ newWage?.jobRankName | bilingualText }}
                      </td>
                      <td>
                        {{ newWage?.jobGradeName | bilingualText }}
                      </td>
                    </tr>
                  </ng-container>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <gosi-alert-dc
          *ngIf="docUploaded"
          type="info"
          [message]="'CONTRIBUTOR.USER-ACTION-DISABLE-MSG' | translate"
          [dismissible]="false"
        >
        </gosi-alert-dc>
        <div class="card-body mt-5">
          <div class="row m-0">
            <div class="custom-ar-label">
              <gosi-input-radio-dc
                id="changeEngagementRadio"
                name="changeEngagement"
                [label]="
                  isPPA
                    ? 'CONTRIBUTOR.COMPLIANCE.INSPECTION-RADIO-LBL-PPA'
                    : 'CONTRIBUTOR.COMPLIANCE.INSPECTION-RADIO-LBL'
                "
                [control]="changeEngForm.get('choice')"
                [list]="changeEngList"
                (select)="listenForChangeEng($event)"
                [disabled]="isBillBatch || checkForDocumentUpload() || isUnclaimed"
              >
              </gosi-input-radio-dc>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row" *ngIf="isPPA && contributorDocs?.length > 0">
      <div class="col-md-12">
        <gosi-document-list-view-dc [documents]="contributorDocs"></gosi-document-list-view-dc>
      </div>
    </div>
    <ng-template #onwards>{{ 'CONTRIBUTOR.ONWARDS' | translate }}</ng-template>
    <div *ngIf="isDocumentUpload && !isUnclaimed">
      <!-- document upload section -->
      <cnt-document-upload-dc
        [documentList]="documents"
        [businessKey]="engagementId"
        [transactionId]="transactionId"
        [parentForm]="changeEngForm"
        [referenceNo]="referenceNo"
        [showDocuments]="isDocumentUpload"
        [showComments]="isDocumentUpload"
        (refresh)="refreshDocument($event)"
        [uuid]="uuid"
      >
      </cnt-document-upload-dc>
      <!-- <cnt-contract-file-upload-dc
        [parentForm]="cancelEngForm"
        [engagementId]="violationDetails?.engagementId"
        [documentList]="documents"
        [contractId]="payload?.requestId"
        [referenceNumber]="referanceNumber"
        [transactionNumber]="cancelEngBusinessKey"
        [infoMessage]="'CONTRIBUTOR.COMPLIANCE.ATLEAST-ONE_DOC'"
        [uuid]="uuid"
        (refresh)="refreshDocument($event)"
      ></cnt-contract-file-upload-dc> -->

      <!-- <div class="card mt-4">
        <div class="card-body">
          <div class="row m-0">
            <div class="col-sm-12 col-md-12 p-0">
              <gosi-input-text-area-dc
                [label]="'CONTRIBUTOR.COMMENTS' | translate"
                id="comments"
                name="comments"
                [maxLength]="commentMaxLength"
                [control]="cancelEngForm.get('comments')"
              ></gosi-input-text-area-dc>
            </div>
          </div>
        </div>
      </div> -->
    </div>
    <div class="row m-0" *ngIf="!isUnclaimed && !isPPA">
      <gosi-input-checkbox-dc
        id="changeEngAcknowledge"
        name="engAcknowledge"
        [control]="changeEngForm.get('acknowledge')"
        [label]="
          'CONTRIBUTOR.COMPLIANCE.INSPECTION-CHECKBOX-LBL'
            | translate
              : {
                  est_Name:
                    currentLang === 'en'
                      ? establishmentDetails?.name.english || establishmentDetails?.name.arabic
                      : establishmentDetails?.name.arabic
                }
        "
      >
      </gosi-input-checkbox-dc>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <cnt-action-area-dc
          primaryButtonLabel="CONTRIBUTOR.SUBMIT"
          (submit)="confirmEngagement()"
          (cancel)="cancelTransaction()"
          [disablePrimary]="isBillBatch"
          [isUnclaimed]="isUnclaimed"
        >
        </cnt-action-area-dc>
      </div>
    </div>
  </div>
</div>
