<!-- Copyright GOSI. All Rights Reserved.
This software is the proprietary information of GOSI.
Use is subject to license terms. -->
<div class="row">
  <div class="col-md-12">
    <gosi-card-dc [showCard]="showCard" type="secondary" heading="{{ heading | translate }}" headingSize="md">
      <div class="row" *ngIf="isRestartHeir">
        <div class="col-lg-12 bd-highlight">
          <form [formGroup]="newPaymentForm" *ngIf="newPaymentForm">
            <div class="bd-highlight toggle-details p-2">
              <div class="d-flex">
                <span class="d-flex align-items-center">{{
                  'BENEFITS.NEW-PAYMENT-OPTIONAL-QUESTION' | translate
                }}</span>
                <div class="mx-auto"></div>
                <gosi-input-toggle-dc
                  [id]="'newPaymentToggle' + paymentIndex"
                  class="slider"
                  [name]="'newPaymentToggle' + paymentIndex"
                  [control]="newPaymentForm.get('isNewPayment')"
                  [ignoreLabel]="true"
                >
                </gosi-input-toggle-dc>
              </div>
            </div>
          </form>
        </div>
      </div>
      <gosi-input-radio-dc
        *ngIf="!hidePayeeType && !isIndividualApp"
        [label]="'BENEFITS.PAYEE' | translate"
        [id]="'payeeType' + personId + paymentIndex"
        [name]="'payeeType' + personId + paymentIndex"
        [control]="payeeForm.get('payeeType')"
        [list]="payeeListToShow"
        (select)="selectPayeeType($event)"
        [noMargin]="true"
      >
      </gosi-input-radio-dc>

      <gosi-alert-dc
        *ngIf="attorneyList?.length <= 0 && payee === 2"
        [message]="'BENEFITS.AUTHORISED-PERSON-INFO' | translate"
        type="info"
        [dismissible]="false"
      >
      </gosi-alert-dc>

      <div *ngIf="payee === 2 && attorneyList?.length" class="row mb-3">
        <div class="col-12">
          <label for="auth" placement="top" triggers="mouseenter:mouseleave"
            >{{ 'BENEFITS.SELECT-AUTHORISED-PERSON' | translate }}
          </label>
        </div>

        <div class="form-group d-flex align-items-center col-12" *ngFor="let attorney of attorneyList; let i = index">
          <div class="custom-control">
            <input
              class="custom-control-input"
              [name]="'name' + i + paymentIndex"
              type="radio"
              (change)="setAuthPerson(i)"
              id="{{ 'authPersonId' + i + paymentIndex }}"
              [checked]="attorney.personId === payeeForm.get('personId')?.value"
            />
            <label class="custom-control-label" for="{{ 'authPersonId' + i + paymentIndex }}"> </label>
          </div>
          <div class="row bg-color w-100 pb-3 pt-3">
            <div class="col-md-6">
              <div>
                {{ attorney.name | nameToString }}
              </div>
              <div *ngIf="attorney.identity[0]?.newNin">
                {{ 'BENEFITS.NATIONAL-ID' | translate }} : {{ attorney.identity[0].newNin }}
              </div>
              <!-- <div *ngIf="attorney.identity[0]?.passportNo">
                {{ 'BENEFITS.PASSPORT-NO' | translate }} : {{ attorney.identity[0].passportNo }}
              </div>
              <div *ngIf="attorney.identity[0].iqamaNo">
                {{ 'BENEFITS.IQAMA-NUMBER' | translate }} : {{ attorney.identity[0].iqamaNo }}
              </div>
              <div *ngIf="attorney.identity[0].idType === 'BORDERNO'">
                {{ 'BENEFITS.BORDER-NO' | translate }} : {{ attorney.identity[0].id }}
              </div>
              <div *ngIf="attorney.identity[0].idType === 'GCCID'">
                {{ 'BENEFITS.GCC-NIN' | translate }} : {{ attorney.identity[0].id }}
              </div> -->
            </div>
            <div class="col-md-6" *ngIf="attorney.attorneyDetails.certificateExpiryDate">
              <div>
                {{ 'BENEFITS.AUTHORIZATION-CERTIFICATE-EXPIRY-DATE' | translate }}
              </div>
              <div>
                {{ attorney.attorneyDetails.certificateExpiryDate | dateType }}
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- TODO: route back and populate added auth person details in benefit details page -->
      <!-- <div class="row ml-1 item-align" *ngIf="payee === 2">
          <a class="mr-auto action-item-btn"
          routerLinkActive="active"
          (click)="navigateToAuthPerson()">
            {{ 'BENEFITS.CLICK-HERE-TO-ADD-AUTHORISATION' | translate }}
          </a>
        </div> -->
      <ng-container *ngIf="payee === 3">
        <gosi-alert-dc
          *ngIf="!listOfGuardians || listOfGuardians?.length <= 0"
          [message]="'BENEFITS.NO-GUARDIAN-DETAILS FOUND' | translate"
          type="info"
          [dismissible]="false"
        >
        </gosi-alert-dc>
        <div
          class="form-group d-flex align-items-center col-12"
          *ngFor="let attorney of listOfGuardians; let i = index"
        >
          <div class="custom-control">
            <input
              class="custom-control-input"
              name="{{ 'guardianName' + personId + i + paymentIndex }}"
              type="radio"
              (change)="getGuardianPerson(i)"
              id="{{ 'guardianId' + personId + i + paymentIndex }}"
              [checked]="attorney.personId === payeeForm.get('guardianPersonId')?.value"
            />
            <label class="custom-control-label" for="{{ 'guardianId' + personId + i + paymentIndex }}"> </label>
          </div>
          <div class="row bg-color w-100 pb-3 pt-3">
            <div class="col-md-4">
              <div>
                {{ attorney.name | nameToString }}
              </div>
              <ng-container *ngIf="attorney?.identity && attorney?.identity?.length > 0">
                <div *ngIf="attorney?.identity[0]?.newNin">
                  {{ 'BENEFITS.NATIONAL-ID' | translate }} :
                  <a routerLinkActive="active"
                    ><u>{{ attorney.identity[0].newNin }}</u></a
                  >
                </div>
                <div *ngIf="attorney?.identity[0]?.passportNo">
                  {{ 'BENEFITS.PASSPORT-NO' | translate }} :
                  <a routerLinkActive="active"
                    ><u>{{ attorney.identity[0].passportNo }}</u></a
                  >
                </div>
                <div *ngIf="attorney?.identity[0]?.iqamaNo">
                  {{ 'BENEFITS.IQAMA-NUMBER' | translate }} :
                  <a routerLinkActive="active"
                    ><u>{{ attorney?.identity[0]?.iqamaNo }}</u></a
                  >
                </div>
                <div *ngIf="attorney?.identity[0]?.idType === 'BORDERNO'">
                  {{ 'BENEFITS.BORDER-NO' | translate }} :
                  <a routerLinkActive="active"
                    ><u>{{ attorney?.identity[0]?.id }}</u></a
                  >
                </div>
                <div *ngIf="attorney?.identity[0]?.idType === 'GCCID'">
                  {{ 'BENEFITS.GCC-NIN' | translate }} :
                  <a routerLinkActive="active"
                    ><u>{{ attorney.identity[0].id }}</u></a
                  >
                </div>
              </ng-container>
            </div>
            <div class="col-md-4">
              <gosi-label-dc
                id="certificateNumber"
                [isLink]="true"
                label="{{ 'BENEFITS.CERTIFICATE-NUMBER' | translate }}"
                [value]="attorney?.attorneyDetails?.certificateNumber"
              ></gosi-label-dc>
            </div>
            <div class="col-md-4" *ngIf="attorney?.attorneyDetails?.certificateExpiryDate">
              <gosi-label-dc
                id="certificateDate"
                label="{{ 'BENEFITS.CERTIFICATE-EXPIRATION-DATE' | translate }}"
                [value]="(attorney?.attorneyDetails?.certificateExpiryDate | dateType) || '-'"
              ></gosi-label-dc>
            </div>
          </div>
        </div>
        <!--        <div class="row ml-1 item-align">-->
        <!--          <a class="mr-auto action-item-btn">-->
        <!--            {{ 'BENEFITS.CLICK-HERE-TO-ADD-AUTHORISATION' | translate }}-->
        <!--          </a>-->
        <!--        </div>-->
      </ng-container>
      <div
        class="pt-3"
        *ngIf="
          !isIndividualApp &&
          (payee === 1 ||
            (payee === 2 && attorneyList?.length) ||
            (payee === 3 && this.listOfGuardians && this.listOfGuardians?.length > 0)) &&
          showPaymentMethod
        "
      >
        <gosi-input-radio-dc
          [ngClass]="paymentMethodList.items.length < 2 ? 'display: hide' : ''"
          [id]="'paymentMethod' + personId + paymentIndex"
          [label]="'BENEFITS.PAYMENT-METHOD' | translate"
          [name]="'paymentMethod' + personId + paymentIndex"
          [control]="payeeForm.get('paymentMode')"
          [list]="paymentMethodList"
          (select)="selectPaymentMethod($event)"
          [disabled]="readOnly"
          [noMargin]="true"
        >
        </gosi-input-radio-dc>
      </div>
      <!-- <bnt-add-guardian-dc
        *ngIf="payee === 3"
        [systemRunDate]="systemRunDate"
        [listYesNo$]="listYesNo$"
        [bankDetails]="bankDetails"
        [hideChooseGuardian]="hideChooseGuardian"
        [nationalityList$]="nationalityList$"
        [listOfGuardians]="listOfGuardians"
        [paymentMethodList]="paymentMethodList"
        [parentForm]="payeeForm"
        [update]="true"
        (searchGuardian)="searchGuardian($event)"
        (getBankDetails)="getBankForGuardian($event)"
        [guardianDetails]="guardianDetails"
      >
      </bnt-add-guardian-dc> -->
      <pmt-bank-details-saned-dc
        *ngIf="showBankDetail && !newBankForm"
        #bankDetailsChildComp
        [showCard]="showCardForBank"
        [bankDetails]="bankDetails"
        [parentForm]="parentForm"
        [hideSaveButton]="hideSaveButton"
        (editEvent)="saveBankDetails($event)"
        [saveApiResp]="saveApiResp"
        [lang]="lang"
      >
      </pmt-bank-details-saned-dc>
      <!-- TODO bank deatils new screen -->
      <pmt-bank-account-details-dc
        *ngIf="(showBankDetail && newBankForm) || isIndividualApp"
        #bankDetailsChildComp
        [bankName]="bankName"
        [isValidator]="isValidator"
        [lang]="lang"
        [isDraft]="isDraft"
        [isIndividualApp]="isIndividualApp"
        [savedPayeType]="savedPayeType"
        [listYesNo]="listYesNo"
        [showCard]="showCardForBank"
        [bankDetails]="bankAccountList"
        [valNonsaudiBankDetails]="valNonsaudiBankDetails"
        [parentForm]="payeeForm"
        [ibanBankAccountNo]="ibanBankAccountNo"
        (getBankName)="getBankNameFor($event)"
      >
      </pmt-bank-account-details-dc>
      <frm-address-dc
        *ngIf="
          payee === 1 && payeeForm?.get('bankAccount')?.get('nationality')?.get('english')?.value === BenefitValues.no
        "
        [idValue]="personId"
        [cityList]="cityList$ | async"
        [showCard]="false"
        [countryList]="countryList$ | async"
        [hasNationalAddress]="true"
        [hasPOAddress]="true"
        [hasOverseasAddress]="true"
        [addressDetails]="savedAddress?.addresses"
        [currentMailingAddress]="savedAddress?.currentMailingAddress"
        [isViewOnly]="
          payeeForm?.get('bankAccount')?.get('nationality')?.get('english').value === BenefitValues.no ||
          !isAddressReadOnly
            ? false
            : true
        "
        [mandatoryOverseasAddress]="
          payeeForm?.get('bankAccount')?.get('nationality')?.get('english')?.value === BenefitValues.no
        "
        (addressTypeSelected)="addressTypeChanged($event)"
        #addressComponent
      >
      </frm-address-dc>
      <!-- [addressDetails]="heirDetail?.contactDetail?.addresses"
      [currentMailingAddress]="heirDetail?.contactDetail?.currentMailingAddress" -->
    </gosi-card-dc>
  </div>
</div>
