<!--
  ~ Copyright GOSI. All Rights Reserved.
  ~  This software is the proprietary information of GOSI.
  ~  Use is subject to license terms.
  -->

<div class="mof-content" *ngIf="contributionMonthDetails">
  <div class="row heading-section">
    <div class="col-auto mr-auto heading">
      {{ 'BILLING.CONTRIBUTION-DETAILS' | translate | titlecase }}
    </div>
    <div class="period-search-sort-filter search-menu">
      <div class="search">
        <gosi-search-dc
          [placeholder]="'BILLING.SEARCH' | translate"
          (search)="onSearchEstablishment($event)"
          (keyup)="onSearchEstablishment($event.target.value)"
        >
        </gosi-search-dc>
      </div>
      <div class="filter-padding">
        <blg-mof-itemized-contribution-filter-dc
          (mofContributionFilterValues)="applyFilterValues($event)"
          [yesOrNoList]="yesOrNoList"
        >
        </blg-mof-itemized-contribution-filter-dc>
      </div>
      <div class="margin"></div>
      <div class="sort">
        <gosi-sort-dc
          [list]="mofContributionSortFields"
          (direction)="sortListOrder($event)"
          (sortItemSelected)="sortListValue($event)"
        >
        </gosi-sort-dc>
      </div>
    </div>
  </div>
  <ng-container *ngIf="contributionMonthDetails?.length > 0; else noResultFound">
    <div class="row">
      <div class="col-lg-12">
        <div class="table-scroll table-responsive">
          <table class="table table-borderless table-effect">
            <thead class="table-header">
              <tr>
                <th rowspan="2" id="deatils">
                  {{ 'BILLING.ESTABLISHMENT-NAME' | translate | titlecase }}
                </th>
                <th rowspan="2" id="date">
                  {{ 'BILLING.REGISTRATION-NUMBER' | translate | titlecase }}
                </th>
                <th rowspan="2" id="date">
                  {{ 'BILLING.ADJUSTMENT-INDICATOR' | translate | titlecase }}
                </th>
                <th rowspan="1" colspan="4" id="periods" class="align" *ngIf="establishmentType === 'GOSI'">
                  {{ 'BILLING.COVERAGE' | translate | titlecase }}
                  <span class="currencyVal">({{ 'BILLING.SAR' | translate }}) </span>
                </th>
                <th rowspan="1" colspan="2" id="periods" class="align" *ngIf="establishmentType === 'PPA'">
                  {{ 'BILLING.COVERAGE' | translate | titlecase }}
                  <span class="currencyVal">({{ 'BILLING.SAR' | translate }}) </span>
                </th>
                <th rowspan="2" id="date">
                  {{ 'BILLING.TOTAL' | translate | titlecase }}
                  <span class="currencyVal">({{ 'BILLING.SAR' | translate }}) </span>
                </th>
              </tr>
              <tr>
                <th id="fromDate" class="align" *ngIf="establishmentType ==='GOSI'">{{ 'BILLING.ANNUITY' | translate | titlecase }}</th>
                <th id="annuityValue" class="alignment" *ngIf="establishmentType ==='PPA'">{{ 'BILLING.PPA-ANNUITY' | translate | titlecase }}</th>
                <th id="annuityValue" class="alignment">{{ 'BILLING.PPA-PENSION' | translate | titlecase }}</th>
                <th id="toDate" class="align" *ngIf="establishmentType ==='GOSI'">{{ 'BILLING.OCCUPATIONAL-HAZARD' | translate | titlecase }}</th>
                <th id="annuityValue" class="alignment" *ngIf="establishmentType ==='GOSI'">{{ 'BILLING.UI' | translate | titlecase }}</th>
              </tr>
            </thead>
            <tbody>
              <ng-container *ngIf="itemizedContributionMonth !== null">
                <ng-container
                  *ngFor="
                    let item of contributionMonthDetails
                      | paginate
                        : {
                            id: 'paginationId',
                            itemsPerPage: itemsPerPage,
                            currentPage: pageDetails.currentPage,
                            totalItems: itemizedContributionMonth.availableCount
                          };
                    let i = index
                  "
                >
                  <tr class="border-bottom">
                    <a class="view-details" (click)="getContributorDetails(item.registrationNo)">
                      <td *ngIf="item.establishmentName?.english !== null">
                        {{ item.establishmentName | bilingualText }}
                      </td>

                      <td *ngIf="item.establishmentName.english === null">
                        {{ item.establishmentName.arabic }}
                      </td>
                    </a>
                    <td>{{ item.registrationNo }}</td>
                    <td>{{ item.adjustmentIndicator | bilingualText }}</td>
                    <td class="align" *ngIf="establishmentType ==='GOSI'">
                      {{ item.thirdPartyContributionShare.establishmentShare.annuity | number: '1.2-2' }}
                    </td>
                    <td class="align" *ngIf="establishmentType ==='PPA'">
                      {{ item.thirdPartyContributionShare.establishmentShare.ppaAnnuity | number: '1.2-2' }}
                    </td>
                    <td class="align">
                      {{ item.thirdPartyContributionShare.establishmentShare.prAnnuity | number: '1.2-2' }}
                    </td>
                    <td class="align" *ngIf="establishmentType ==='GOSI'">
                      {{ item.thirdPartyContributionShare.establishmentShare.oh | number: '1.2-2' }}
                    </td>
                    <td class="align" *ngIf="establishmentType ==='GOSI'">
                      {{ item.thirdPartyContributionShare.establishmentShare.ui | number: '1.2-2' }}
                    </td>
                    <td>{{ item.thirdPartyContributionShare.total | number: '1.2-2' }}</td>
                  </tr>
                </ng-container>
              </ng-container>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </ng-container>
  <ng-container>
    <div>
      <gosi-pagination-dc
        *ngIf="itemizedContributionMonth?.availableCount > itemsPerPage"
        [totalSize]="itemizedContributionMonth.availableCount"
        [itemsPerPage]="itemsPerPage"
        [pageDetails]="pageDetails"
        (pageChange)="selectPage($event)"
        paginationId="paginationId"
      ></gosi-pagination-dc>
    </div>
  </ng-container>
  <ng-template #noResultFound>
    <div class="col-lg-12">
      <div class="mt-10 text-center">
        <img src="assets/images/search-error.svg" alt="search-error" />
        <br />
        <p class="text-muted">{{ 'BILLING.NO-DATA' | translate | titlecase }}</p>
      </div>
    </div>
  </ng-template>
</div>
