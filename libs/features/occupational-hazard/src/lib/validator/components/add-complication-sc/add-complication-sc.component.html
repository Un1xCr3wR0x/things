<!-- Copyright GOSI. All Rights Reserved.
This software is the proprietary information of GOSI.
Use is subject to license terms. -->
<!-- Common breadcrumb component -->
<gosi-breadcrumb-dc> </gosi-breadcrumb-dc>

<div class="content">
  <div id="mainHeading">
    <frm-main-heading-dc
      [heading]="'OCCUPATIONAL-HAZARD.COMPLICATION.REPORT-COMPLICATION' | translate"
      [subLabel]="'OCCUPATIONAL-HAZARD.SOCIAL-INSURANCE-NO' | translate"
      [subValue]="socialInsuranceNo"
    >
    </frm-main-heading-dc>
    <!-- Comment and Document Area-->
    <frm-main-content-dc
      [canEdit]="false"
      [documents]="complicationDocumentList ? complicationDocumentList : []"
      [autoValidationComments]="
        complicationDetails.autoValidationComments ? complicationDetails.autoValidationComments : []
      "
      [comments]="comment ? comment : []"
      (onEdit)="navigateToScan()"
    >
      <div id="contentArea">
        <!-- personal details View-->
        <oh-vtr-personal-details-dc
          *ngIf="contributor && contributor.person"
          [canEdit]="canEdit"
          [person]="contributor.person"
          [engagement]="engagement"
          (onEdit)="navigateToEdit()"
        >
        </oh-vtr-personal-details-dc>
        <div class="col-lg-12 complication-item"></div>
        <!-- Contact Details -->
        <div class="row contact-details">
          {{ 'OCCUPATIONAL-HAZARD.CONTACT-DETAILS' | translate }}
        </div>
        <div class="emergency-no">
          <gosi-label-dc
            id="emergencyContactNumber"
            [control]="complicationDetails.emergencyContactNo.primary"
            label="OCCUPATIONAL-HAZARD.EMERGENCY-CONTACT-NUMBER"
            ><span id="prefixValue">{{ getISDCodePrefix(complicationDetails.emergencyContactNo) }}</span>
          </gosi-label-dc>
        </div>
        <div class="col-lg-12 complication-item-separator"></div>
        <!-- Injury details View -->
        <oh-vtr-injury-details-dc
          [Injury]="complicationDetails.injuryDetails"
          (injurySelected)="viewInjury()"
        ></oh-vtr-injury-details-dc>
        <oh-vtr-complication-details-timeline-dc
          [isContributor]="isContributor"
          [canEdit]="false"
          [complication]="complicationDetails"
          [establishment]="establishment"
          [engagement]="engagement"
          (complicationSelected)="viewComplication()"
          (onEdit)="navigateToEdit()"
        ></oh-vtr-complication-details-timeline-dc>
      </div>
      <div id="actionArea">
        <div class="row">
          <div class="col-lg-12 form-action">
            <div class="add-complication">
              <div class="btn-section float-right" *ngIf="canApprove">
                <gosi-button-dc
                  id="approve"
                  type="primary"
                  name="approveComplication"
                  (click)="showTransaction(approveComplicationTemplate)"
                >
                  {{ 'OCCUPATIONAL-HAZARD.APPROVE' | translate }}</gosi-button-dc
                >
              </div>
              <div class="btn-section float-right" *ngIf="canSubmit">
                <gosi-button-dc
                  id="submit"
                  [type]="'primary'"
                  name="submitComplication"
                  (approveEvent)="confirmApproveComplication()"
                >
                  {{ 'OCCUPATIONAL-HAZARD.SUBMIT' | translate }}</gosi-button-dc
                >
              </div>
              <ng-container>
                <div class="btn-section float-right" *ngIf="canReject">
                  <gosi-button-dc
                    [type]="'danger'"
                    id="reject"
                    name="rejectComplication"
                    (click)="rejectTransaction(rejectComplicationTemplate)"
                  >
                    {{ 'OCCUPATIONAL-HAZARD.REJECT' | translate }}</gosi-button-dc
                  >
                </div>
                <div class="btn-section float-right position-relative" *ngIf="validator1">
                  <gosi-button-dc [type]="'secondary'" [popover]="moreOptionsModal" name="moreOptions" placement="top">
                    {{ 'OCCUPATIONAL-HAZARD.MORE-OPTIONS' | translate }}
                  </gosi-button-dc>
                </div>
                <div class="btn-section float-right" *ngIf="canReturn">
                  <gosi-button-dc
                    [type]="'secondary'"
                    id="return"
                    name="returnComplication"
                    (submit)="showModal(modalAddComplication, 'showAddComplicationReturn')"
                  >
                    {{ 'OCCUPATIONAL-HAZARD.RETURN' | translate }}</gosi-button-dc
                  >
                </div>
              </ng-container>
              <div class="btn-section float-left">
                <gosi-button-dc
                  id="cancel"
                  [type]="'secondary'"
                  name="cancelComplication"
                  (submit)="showCancelTemplate(cancelComplicationTemplate)"
                >
                  {{ 'OCCUPATIONAL-HAZARD.CANCEL' | translate }}</gosi-button-dc
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </frm-main-content-dc>
  </div>
</div>
<ng-template #cancelComplicationTemplate>
  <gosi-confirm-modal-dc
    [message]="'OCCUPATIONAL-HAZARD.CONFIRM-CANCEL'"
    (onConfirm)="confirmCancel()"
    name="confirmCancelComplication"
    (onCancel)="hideModal()"
  >
  </gosi-confirm-modal-dc>
</ng-template>
<!------------------------  Modals ----------------------------->
<ng-template #modalAddComplication>
  <gosi-modal-dc [modalHeader]="headingText | translate">
    <div modalContent class="row">
      <div *ngIf="noteRequest">
        <div *ngIf="validator1 && !isContributor" class="form-group">
          <i class="danger">{{ 'OCCUPATIONAL-HAZARD.INFO-VALIDATOR-RETURN' | translate }}</i>
        </div>
        <div *ngIf="validator1 && isContributor" class="form-group">
          <i class="danger">{{ 'OCCUPATIONAL-HAZARD.INFO-VALIDATOR-CONTRIBUTOR-RETURN' | translate }}</i>
        </div>

        <div *ngIf="!validator1" class="form-group">
          <i class="danger">{{ 'OCCUPATIONAL-HAZARD.INFO-VALIDATOR-RETURN-VALIDATOR' | translate }}</i>
        </div>
      </div>
      <div class="col-lg-12">
        <div class="col-lg-12" *ngIf="commentAlert">
          <gosi-alert-dc message="CORE.ERROR.MANDATORY-FIELDS" type="danger" [dismissible]="true"></gosi-alert-dc>
        </div>
        <div class="col-lg-12" *ngIf="docAlert">
          <gosi-alert-dc
            message="OCCUPATIONAL-HAZARD.DOCUMENT-AVAILABLE"
            type="warning"
            [dismissible]="true"
          ></gosi-alert-dc>
        </div>
      </div>
      <div *ngIf="returnToEstAdmin || returnTpa" class="col-md-12">
        <gosi-input-multi-select-dropdown-dc
          id="requestDocuments"
          name="requestedDocuments"
          [label]="'OCCUPATIONAL-HAZARD.REQUEST-DOCUMENTS' | translate"
          [control]="reportInjuryModal.get('document')"
          [list]="documentListLov"
          (selected)="receiveDocumentList($event)"
        >
        </gosi-input-multi-select-dropdown-dc>
      </div>

      <div class="col-lg-12">
        <gosi-input-text-area-dc
          id="validatorComments"
          [maxLength]="maxLengthComments"
          label="OCCUPATIONAL-HAZARD.COMMENTS"
          [name]="'rejectionComments'"
          [control]="reportInjuryModal.get('comments')"
        >
        </gosi-input-text-area-dc>
      </div>
    </div>
    <div class="col-lg-12" modalAction>
      <div class="btn-section float-right" *ngIf="showConfirmReturnBtn">
        <gosi-button-dc
          id="confirmReturnBtn"
          [type]="'primary'"
          name="returnComplication"
          class="action-button"
          (submit)="returnComplication()"
        >
          {{ 'OCCUPATIONAL-HAZARD.RETURN' | translate }}</gosi-button-dc
        >
      </div>
      <div class="btn-section float-right" *ngIf="showConfirmSubmitBtn">
        <gosi-button-dc
          id="confirmSubmitBtn"
          type="danger"
          class="action-button"
          (submit)="requestTpaAddComplication()"
        >
          {{ 'OCCUPATIONAL-HAZARD.SUBMIT' | translate }}</gosi-button-dc
        >
      </div>
      <div class="btn-section float-left">
        <gosi-button-dc id="cancelApproveBtn" name="cancelComplication" [type]="'secondary'" (submit)="hideModal()">
          {{ 'OCCUPATIONAL-HAZARD.CANCEL' | translate }}
        </gosi-button-dc>
      </div>
    </div>
  </gosi-modal-dc>
</ng-template>

<ng-template #moreOptionsModal>
  <button
    type="button"
    *ngIf="returnToEstAdmin && !isContributor"
    (click)="showModal(modalAddComplication, 'showAddComplicationReturn')"
    class="d-flex btn text-left more-action-button"
  >
    {{ 'OCCUPATIONAL-HAZARD.RETURN-TO-ESTABLISHMENT_ADMIN' | translate }} 
  </button>

  <button
    type="button"
    *ngIf="returnToEstAdmin && isContributor"
    (click)="showModal(modalAddComplication, 'showAddComplicationReturn')"
    class="d-flex btn text-left more-action-button"
  >
    {{ 'OCCUPATIONAL-HAZARD.RETURN-TO-CONTRIBUTOR' | translate }}
    <!-- Use labels -->
  </button>
  <button
    type="button"
    class="d-flex btn text-left more-action-button"
    (click)="showModal(modalAddComplication, 'showAddComplicationSubmit')"
  >
    {{ 'OCCUPATIONAL-HAZARD.REQUEST-CLARIFICATION' | translate }}
    <!--Use labels-->
  </button>
</ng-template>

<ng-template #approveComplicationTemplate>
  <frm-approve-template-dc
    [heading]="'OCCUPATIONAL-HAZARD.CNF-APPROVE'"
    (cancelEvent)="hideModal()"
    (approveEvent)="confirmApprove()"
    [parentForm]="reportInjuryForm"
  >
  </frm-approve-template-dc>
</ng-template>
<ng-template #requestComplicationTemplate>
  <div>
    <oh-request-template-dc
      [heading]="'OCCUPATIONAL-HAZARD.REQUEST-INSPECTION'"
      (cancelEvent)="hideModal()"
      [warningMessage]="warningMsg | translate"
      (submitEvent)="confirmInspection(null, actionName)"
      (selectedInspect)="setInspectionMessage($event)"
      [parentForm]="reportInjuryForm"
      [inspectionList$]="inspectionList"
    >
    </oh-request-template-dc>
    <ng-template #closedOHComplication>
      <gosi-alert-dc [message]="inspectionMsg" [dismissible]="false" type="danger"></gosi-alert-dc>
      <gosi-button-dc type="secondary" (submit)="hideModal()" class="row pb-3 align-self-center" id="cancelBtn">
        {{ 'OCCUPATIONAL-HAZARD.CLOSE' | translate }}
      </gosi-button-dc>
    </ng-template>
  </div>
</ng-template>
<!----Reject template---->
<ng-template #rejectComplicationTemplate>
  <frm-reject-template-dc
    [warningMessage]="warning"
    [transactionNumber]="transactionNumber"
    [rejectReasonList$]="rejectReasonList"
    [injuryRejectReasonList$]="injuryRejectReasonList$"
    (cancelEvent)="hideModal()"
    [parentForm]="reportInjuryForm"
    (rejectEvent)="confirmRejectComplication()"
    [isComplication]="isParentInjuryRejection"
    isRejectInjury="true"
    [isEstClosed]="isEstClosed"
    [type]="type"
  >
  </frm-reject-template-dc>
</ng-template>
