<!--
  ~ Copyright GOSI. All Rights Reserved.
  ~  This software is the proprietary information of GOSI.
  ~  Use is subject to license terms.
  -->

<div class="row">
  <div class="col-lg-12 date">
    {{ 'BILLING.AS-ON' | translate }}
    {{ currentMonth | translate: currentDate }}
  </div>
</div>
<div class="row justify-content-between">
  <div class="col-lg-5">
    <div class="row mt-3" *ngIf="!creditBalance">
      <div class="col-lg-6 col-view-6 amount-label">
        {{ 'BILLING.BILL-AMOUNT' | translate }}
        <fa-icon [icon]="['fas', 'info-circle']" [tooltip]="billAmountToolTemplate"></fa-icon>
      </div>
      <div class="col-lg-6 col-view-6 amount danger font-weight-bold" id="billAmountValue">
        {{ billBalanceDetails.balanceDue | number: '1.2-2' }}
        {{ 'BILLING.SAR' | translate }}
      </div>
    </div>
    <div class="row mt-3" *ngIf="creditBalance">
      <div class="col-lg-6 col-view-6 amount-label">
        {{ 'BILLING.CREDIT-FROM-LAST-BILL' | translate }}
        <fa-icon [icon]="['fas', 'info-circle']" [tooltip]="billAmountToolTemplate"></fa-icon>
      </div>
      <div class="col-lg-6 col-view-6 amount primary font-weight-bold" id="lastbillAmountValue">
        {{ lastBillAmount | number: '1.2-2' }}
        {{ 'BILLING.SAR' | translate }}
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-lg-6 col-view-6 amount-label">
        {{ 'BILLING.RECEIPTS-AND-CREDITS' | translate }}
        <fa-icon [icon]="['fas', 'info-circle']" [tooltip]="receiptCreditToolTemplate"></fa-icon>
      </div>
      <div class="col-lg-6 col-view-6 amount primary" id="creditBalanceAvailableValue">
        {{ billBalanceDetails.paidAmount | number: '1.2-2' }}
        {{ 'BILLING.SAR' | translate }}
      </div>
    </div>
    <div *ngIf="billBalanceDetails?.creditBalanceRefunded !== 0" class="row mt-3">
      <div class="col-lg-6 col-view-6 amount-label">
        {{ 'BILLING.CREDIT-REFUND' | translate }}
      </div>
      <div class="col-lg-6 col-view-6 amount danger" id="creditBalanceAvailableValue">
        {{ billBalanceDetails?.creditBalanceRefunded * exchangeRate | number: '1.2-2' }}
        {{ 'BILLING.SAR' | translate }}
      </div>
    </div>
    <div class="row separator"></div>
    <div class="row mt-3" *ngIf="!excessPaidFlag && unPaidAmount !== 0">
      <div class="col-lg-4 col-view-6 sum-label">
        {{ 'BILLING.UNPAID-BALANCE' | translate }}
      </div>

      <div class="col-lg-8 col-view-6 sum-amount amount-value" id="unpaidBalanceValue">
        {{ unPaidAmount | number: '1.2-2' }}
        {{ 'BILLING.SAR' | translate }}
      </div>
    </div>
    <div class="row mt-3" *ngIf="unPaidAmount === 0">
      <div class="col-lg-4 col-view-6 sum-label">
        {{ 'BILLING.UNPAID-BALANCE' | translate }}
      </div>

      <div class="col-lg-8 col-view-6 paid-amount amount-value" id="unpaidBalanceValue">
        {{ unPaidAmount | number: '1.2-2' }}
        {{ 'BILLING.SAR' | translate }}
      </div>
    </div>
    <ng-container *ngIf="unPaidAmount !== 0">
      <div
        class="row mt-3"
        *ngIf="
          (excessPaidFlag && creditBalance) ||
          (billBalanceDetails.paidAmount > billBalanceDetails.balanceDue &&
            billBalanceDetails.paidAmount !== 0 &&
            excessPaidFlag)
        "
      >
        <div class="col-lg-4 col-view-6 sum-label">
          {{ 'BILLING.CREDIT-BALANCE' | translate }}
        </div>
        <div class="col-lg-8 col-view-6 excess-amount amount-value" id="creditAmount">
          {{ creditAmount | number: '1.2-2' }}
          {{ 'BILLING.SAR' | translate }}
        </div>
      </div>
    </ng-container>
  </div>
  <div class="col-lg-3 mt-3 due-date-padding" *ngIf="!excessPaidFlag && unPaidAmount !== 0">
    <blg-vic-due-date-widget-dc [startDate]="billBalanceDetails.dueDate.gregorian"></blg-vic-due-date-widget-dc>
  </div>

  <div class="mr-3">
    <gosi-card-dc type="secondary">

      <div class="header">
        <div>
          {{ 'BILLING.NO-OF-PAID-MONTHS' | translate }}
          <fa-icon [icon]="['fas', 'info-circle']" [tooltip]="paidInfoMessageToolTemplate"></fa-icon>
        </div>

        <div>
          <b>
            {{billHistoryDetails?.noOfPaidContribution}}
            <span>{{ monthLabelDueDate | translate }}</span>
          </b>
        </div>
        
      </div>
      <div class="header pt-3">
          <div>
            {{ 'BILLING.NO-OF-UNPAID' | translate }}
            <fa-icon [icon]="['fas', 'info-circle']" [tooltip]="unpaidInfoMessageToolTemplate"></fa-icon>
          </div>

          <div>
              <b>
                {{billHistoryDetails?.noOfMonthsSinceLastPaid}}
                <span>{{ monthLabelDelayed | translate }}</span>
              </b>
          </div>
          
      </div>

      <ng-template #paidInfoMessageToolTemplate>
          <div class="tooltip-info-message">

              <ng-container >
                  <div class="d-flex flex-column">
                    <div>{{ 'BILLING.DYNAMIC-INFO-MESSAGE-FOR-PAID-MONTHS' | translate}}</div>
                  </div>
                </ng-container>

          </div>
          
      </ng-template>
      <ng-template #unpaidInfoMessageToolTemplate>

        <div class="tooltip-info-message">
            <ng-container >
                <div class="d-flex flex-column">
                  <div>{{ 'BILLING.DYNAMIC-INFO-MESSAGE-FOR-UNPAID-MONTHS' | translate}}</div>
                </div>
              </ng-container>

        </div>
        
    </ng-template>

    </gosi-card-dc>
  </div>

  <ng-container *ngIf="!tempHide">
    <div class="col-lg-3 mt-3 pay-button pay" *ngIf="!excessPaidFlag && unPaidAmount !== 0">
      <gosi-button-dc
        id="pay"
        type="primary"
        isFullWidth="true"
        class="custom-width"
        (submit)="showModal(payBtnPopup, 'md')"
      >
        {{ 'BILLING.PAY' | translate }}</gosi-button-dc
      >
    </div>

    <div class="col-lg-7 pay-button pay-margin pay" *ngIf="excessPaidFlag || unPaidAmount === 0">
      <gosi-button-dc
        id="pay"
        type="primary"
        isFullWidth="true"
        class="custom-width"
        (submit)="showModal(payBtnPopup, 'md')"
      >
        {{ 'BILLING.PAY' | translate }}</gosi-button-dc
      >
    </div>
  </ng-container>
  <ng-container *ngIf="unBillAmount?.violations > 0 || unBillAmount?.rejectedOh > 0">
    <div class="col-lg-3 amount-border border-left">
      <div class="row mt-3">
        <div class="col-lg-8 font-weight-bold">
          {{ 'BILLING.UN-BILLED-AMOUNTS' | translate }}
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-lg-7 amount-label">
          {{ 'BILLING.VIOLATIONS' | translate }}
        </div>
        <div class="col-lg-5 amount danger" id="violationAmount">
          {{ unBillAmount.violations | number: '1.2-2' }}
          {{ 'BILLING.SAR' | translate }}
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-lg-7 amount-label">
          {{ 'BILLING.REJECTED-OH-CLAIMS' | translate }}
        </div>
        <div class="col-lg-5 amount danger" id="ohvalue">
          {{ unBillAmount.rejectedOh | number: '1.2-2' }}
          {{ 'BILLING.SAR' | translate }}
        </div>
      </div>
    </div>
  </ng-container>
</div>
<ng-template #billAmountToolTemplate>
  <ng-container>
    <div class="d-flex flex-column">
      <div>{{ 'BILLING.BILL-AMOUNT-INFO' | translate }}{{ previousMonth | translate: previousDate }}</div>
    </div>
  </ng-container>
</ng-template>
<ng-template #receiptCreditToolTemplate>
  <ng-container>
    <div class="sm">{{ 'BILLING.RECEIPTS-CREDIT-INFO' | translate }}{{ creditMonth | translate: creditDate }}</div>
  </ng-container>
</ng-template>

<!-- Modals -->
<ng-template #payBtnPopup>
  <div class="model-margin">
    <div class="model-align">{{ 'BILLING.MAKE-PAYMENT-VIA' | translate }}</div>
    <div>1. {{ 'BILLING.ONLINE-BANKING' | translate }}</div>
    <div>2. {{ 'BILLING.TELEPHONE-BANKING' | translate }}</div>
    <div>3. {{ 'BILLING.ATM' | translate }}</div>
    <div class="model-align">{{ 'BILLING.VIST-URL' | translate }}</div>
    <div>
      <gosi-button-dc id="confirmBtn" class="float-right" type="secondary" size="md" (submit)="confirmCancel()"
        >{{ 'BILLING.CLOSE' | translate }}
      </gosi-button-dc>
    </div>
  </div>
</ng-template>
