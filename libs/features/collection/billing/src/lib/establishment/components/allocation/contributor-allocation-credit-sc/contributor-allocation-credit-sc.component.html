<!-- /**
 * Copyright GOSI. All Rights Reserved.
 * This software is the proprietary information of GOSI.
 * Use is subject to license terms.
 */ -->

<div class="billing-breadcrumb">
  <gosi-breadcrumb-dc> </gosi-breadcrumb-dc>
</div>
<!-------------------------------------------------------Header Section-------------------------------------------------------->
<div class="row header-section allocation-bill" id="contributorAllocation">
  <div class="col-auto heading-main border-right">
    {{ 'BILLING.ALLOCATION-CONTRIBUTOR-LEVEL' | translate }}
  </div>
  <div class="col-auto heading-main mr-auto establishmentName-margin" id="contributorAllocation-Name">
    <div *ngIf="lang === 'en'">
      {{ establishmentHeader?.name?.english === null ? establishmentName?.arabic : establishmentName?.english }}
    </div>
    <div *ngIf="lang === 'ar'">
      {{ establishmentName.arabic }}
    </div>
    <div class="d-md-none regno" id="estnumber">
      <span> ({{ 'BILLING.REGISTRATION-NUMBER' | translate }} : {{ establishmentHeader.registrationNo }}) </span>
    </div>
  </div>
  <div class="col-auto" id="contributorAllocation-icons" style="display: none">
    <img
      class="icon pr-3 img-size"
      id="pdfDownloadcontributorAllocationBills"
      alt="pdfDownloadcontributorAllocationBills"
      title="{{ 'BILLING.DOWNLOAD-BILL-AS-PDF' | translate }}"
      [src]="pdfImgSrc"
      (mouseover)="pdfImgSrc = 'assets/images/downloadicons/pdf-on-green-bg-hover.svg'"
      (mouseout)="pdfImgSrc = 'assets/images/downloadicons/pdf-on-green-bg-normal.svg'"
    />

    <img
      class="icon pr-3 img-size"
      id="excelDownloadcontributorAllocationBills"
      alt="excelDownloadcontributorAllocationBills"
      title="{{ 'BILLING.DOWNLOAD-BILL-AS-EXCEL' | translate }}"
      [src]="excelImgSrc"
      (mouseover)="excelImgSrc = 'assets/images/downloadicons/xcel-on-green-bg-hover.svg'"
      (mouseout)="excelImgSrc = 'assets/images/downloadicons/xcel-on-green-bg-normal.svg'"
    />
    <img
      class="icon pe-3 img-size"
      id="printcontributorAllocationBills"
      alt="printcontributorAllocationBills"
      title="{{ 'BILLING.PRINT' | translate }}"
      [src]="printImgSrc"
      (mouseover)="printImgSrc = 'assets/images/downloadicons/print-on-green-bg-hover.svg'"
      (mouseout)="printImgSrc = 'assets/images/downloadicons/print-on-green-bg-normal.svg'"
    />
  </div>
</div>
<div class="row regno d-none d-md-flex" id="estnumber">
  <span class="col-lg-12">
    ({{ 'BILLING.REGISTRATION-NUMBER' | translate }} : {{ establishmentHeader.registrationNo }})
  </span>
</div>
<!------------------------------------Header Section Ends--------------------------------------------->
<!---------------------Content Head Section-------------------->
<div class="row">
  <div class="col-lg-12">
    <div class="content">
      <div class="row">
        <div class="col-auto pr-3 border-right align-self-center">
          <a (click)="navigateBackToAllocation()">
            <fa-icon
              class="align-self-center backarrow-icon"
              *ngIf="lang === 'ar'"
              [icon]="['far', 'arrow-alt-circle-right']"
              size="2x"
            ></fa-icon>
            <fa-icon
              class="align-self-center backarrow-icon"
              *ngIf="lang === 'en'"
              [icon]="['far', 'arrow-alt-circle-left']"
              size="2x"
            ></fa-icon>
          </a>
        </div>
        <div class="col-auto allocation-header" id="mof-allocation-header">
          {{ 'BILLING.ALLOCATION-DUR-THE-MONTH' | translate }}
        </div>
        <div class="col-auto bill-month" id="mof-Allocation-date-picker">
          <gosi-input-month-dc
            id="billMonth"
            [ignoreLabel]="true"
            [disabled]="false"
            [dateFormat]="dateFormat"
            [minDate]="minDateCalValue"
            [maxDate]="maxDateCalValue"
            [control]="allocationForm.get('month').get('gregorian')"
            [readOnly]="true"
            class="billMonth"
            (blur)="selectMofStartDate($event)"
          >
          </gosi-input-month-dc>
        </div>
        <div class="closed-label">{{ 'BILLING.CLOSED-ON' | translate }} {{ closedAtDate }}</div>
      </div>
      <!----------------------------------Content Head Section Ends-------------------------------------------->
      <!----------------------------------Allocation Summary Table--------------------------------------------->
      <div class="summary-section">
        <div class="alloc-subheading">
          {{ 'BILLING.ALLOCATION-SUMMARY' | translate }}
        </div>
        <blg-allocation-summary-dc
          [creditSummaryValue]="creditSummaryValue"
          [allocationCreditTotal]="allocationCreditTotal"
          [currentCurrency]="currentCurrency"
          [exchangeRate]="exchangeRate"
          [allocationDetails]="allocationDetails"
        ></blg-allocation-summary-dc>
      </div>
      <!----------------------------------Allocation Summary Table Ends------------------------------------------>
      <!----------------------------------Tabset------------------------------------------>
      <div class="add-margin-top">
        <blg-allocation-tabset-dc
          [selectedTab]="selectedTab"
          [selectedDate]="dateSelected"
          [fromPage]="'contributorAllocation'"
          (tabSelected)="goToNewTab($event)"
          [billIssueDate]="billIssueDate"
          [tabList]="tabList"
        ></blg-allocation-tabset-dc>
      </div>
      <!----------------------------------Tabset Ends------------------------------------------>
      <div class="billtables">
        <!----------------------------------Credit--------------------------------------------->
        <div *ngIf="selectedTab === 'BILLING.CREDITS'">
          <blg-allocation-credit-summary-dc
            [allocationDetails]="allocationDetails"
            [exchangeRate]="exchangeRate"
            [currentCurrency]="currentCurrency"
          ></blg-allocation-credit-summary-dc>
        </div>
        <!----------------------------------Allocation of Credits----------------------------------->
        <div *ngIf="selectedTab === 'BILLING.ALLOCATION-OF-CREDITS'">
          <blg-contributor-allocation-credit-details-dc
            [individualAllocation]="individualAllocation"
            [allocationDetails]="allocationDetails"
            [currentCurrency]="currentCurrency"
            [exchangeRate]="exchangeRate"
            [contributorAllocationSummary]="contributorAllocationSummary"
            (selectPageNo)="getselectPageNo($event)"
            (SearchAmount)="getCreditDetails($event)"
            (sinNumber)="getContributorAllocationDet($event)"
            (allocationFiltervalues)="applyFilterValues($event)"
          >
          </blg-contributor-allocation-credit-details-dc>
        </div>
        <!----------------------------------Summary of contribution and late fee---------------------------->
        <ng-container *ngIf="responsiblePayee === 'ESTABLISHMENT'; else isThirdParty">
          <div *ngIf="selectedTab === 'BILLING.ALLOCATION-CONTRIBUTION-SUMMARY'">
            <blg-allocation-contribution-summary-dc
              [isPPA]="isPPA"
              [creditSummaryValue]="creditSummaryValue"
              [currentCurrency]="currentCurrency"
              [exchangeRate]="exchangeRate"
              [mofEstablishment]="mofEstablishment"
              [responsiblePayee]="responsiblePayee"
            ></blg-allocation-contribution-summary-dc>
          </div>
        </ng-container>
        <ng-template #isThirdParty>
          <div *ngIf="selectedTab === 'BILLING.SUMMARY-CONTRIBUTION-LATEFEE'">
            <blg-allocation-contribution-summary-dc
              [creditSummaryValue]="creditSummaryValue"
              [currentCurrency]="currentCurrency"
              [responsiblePayee]="responsiblePayee"
              [exchangeRate]="exchangeRate"
              [mofEstablishment]="mofEstablishment"
            ></blg-allocation-contribution-summary-dc>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>
