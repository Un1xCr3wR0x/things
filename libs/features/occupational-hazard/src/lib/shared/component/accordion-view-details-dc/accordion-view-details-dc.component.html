<!-- Copyright GOSI. All Rights Reserved.
This software is the proprietary information of GOSI.
Use is subject to license terms. -->

<accordion class="add-allowance-accordion" *ngIf="allowances || claims">
  <accordion-group class="wrapper-accordion-group" [isDisabled]="allowances?.isDisabled && allowanceTab">
    <div accordion-heading class="allowance-name col-md-auto mr-auto" [ngClass]="claims ? 'claims' : 'allowance'">
      <div *ngIf="allowances">
        <div class="currency">{{ allowances.amount }} {{ 'OCCUPATIONAL-HAZARD.ALLOWANCE.SAR' | translate }}</div>
      </div>
      <div *ngIf="claims && claims?.claimType !== null">
        <div *ngIf="claims && !isReimSubPending && claims?.claimType.english !== 'Reimbursement'">
          <div class="currency">
            {{ getTotalExpenses(claims) }} {{ 'OCCUPATIONAL-HAZARD.ALLOWANCE.SAR' | translate }}
          </div>
        </div>
        <div *ngIf="claims && !isReimSubPending && claims?.claimType.english === 'Reimbursement'">
          <div class="currency">
            {{ getTotalExpense(claims) }} {{ 'OCCUPATIONAL-HAZARD.ALLOWANCE.SAR' | translate }}
          </div>
        </div>
      </div>
      <ng-container
        *ngIf="
          allowances &&
            allowances.allowanceType &&
            (allowances.allowanceType.english === 'InPatient Daily Allowance' ||
              allowances.allowanceType.english === 'OutPatient Daily Allowance' ||
              allowances.allowanceType.english === 'OutPatient Allowance' ||
              allowances.allowanceType.english === 'Companion Daily Allowance' ||
              allowances.allowanceType.english === 'InPatient Daily Allowance Adjustment' ||
              allowances.allowanceType.english === 'OutPatient Daily Allowance Adjustment');
          else allowanceType
        "
      >
        <span
          class="allowance-type"
          *ngIf="
            (allowances && allowances.allowanceType.english === 'InPatient Daily Allowance') ||
            allowances.allowanceType.english === 'OutPatient Daily Allowance' ||
            allowances.allowanceType.english === 'OutPatient Allowance'
          "
        >
          {{ 'OCCUPATIONAL-HAZARD.ALLOWANCE.DAILY-ALLOWANCE' | translate }}
          <span *ngIf="allowances.reissue"
            >({{ 'OCCUPATIONAL-HAZARD.ALLOWANCE.RE-ISSUE ALLOWANCE' | translate }})</span
          ></span
        >
        <span
          class="allowance-type"
          *ngIf="
            (allowances && allowances.allowanceType.english === 'InPatient Daily Allowance Adjustment') ||
            allowances.allowanceType.english === 'OutPatient Daily Allowance Adjustment'
          "
        >
          {{ 'OCCUPATIONAL-HAZARD.ALLOWANCE.DAILY-ALLOWANCE-ADJUSTMENT' | translate }}
          <span *ngIf="allowances.reissue">({{ 'OCCUPATIONAL-HAZARD.ALLOWANCE.RE-ISSUE ALLOWANCE' | translate }})</span>
        </span>
        <span
          class="allowance-type"
          *ngIf="allowances && allowances.allowanceType.english === 'Companion Daily Allowance'"
        >
          {{ 'OCCUPATIONAL-HAZARD.ALLOWANCE.COMPANION-ALLOWANCE' | translate }}
          <span *ngIf="allowances.reissue">({{ 'OCCUPATIONAL-HAZARD.ALLOWANCE.RE-ISSUE ALLOWANCE' | translate }})</span>
        </span>
      </ng-container>
      <ng-template #allowanceType>
        <div *ngIf="allowances" class="type-of-allowance">
          <span class="allowance-type && allowances.allowanceType">
            {{ allowances.allowanceType | bilingualText }}
            <span *ngIf="allowances.reissue"
              >({{ 'OCCUPATIONAL-HAZARD.ALLOWANCE.RE-ISSUE ALLOWANCE' | translate }})</span
            >
          </span>
        </div>
      </ng-template>
      <ng-container
        *ngIf="
          claims &&
            claims?.claimType &&
            (claims?.claimType?.english === 'Total Disability Repatriation Expense' ||
              claims?.claimType?.english === 'Dead Body Repatriation Expenses');
          else otherClaims
        "
      >
        <span class="allowance-type" *ngIf="claims.claimType.english === 'Total Disability Repatriation Expense'">
          {{ 'OCCUPATIONAL-HAZARD.CLAIMS.TOTAL-DISABILITY' | translate }}
          <span *ngIf="claims.reissue">({{ 'OCCUPATIONAL-HAZARD.CLAIMS.RE-ISSUE CLAIM' | translate }})</span>
        </span>
        <span class="allowance-type" *ngIf="claims.claimType.english === 'Dead Body Repatriation Expenses'">
          {{ 'OCCUPATIONAL-HAZARD.CLAIMS.DEAD-BODY' | translate }}
          <span *ngIf="claims.reissue">({{ 'OCCUPATIONAL-HAZARD.CLAIMS.RE-ISSUE CLAIM' | translate }})</span>
        </span>
      </ng-container>

      <ng-template #otherClaims>
        <span class="allowance-type" *ngIf="isReimSubPending">
          {{ 'OCCUPATIONAL-HAZARD.CLAIMS.REIMBURSEMENT-REQUEST' | translate }}</span
        >
        <span class="allowance-type" *ngIf="claims && !isReimSubPending">
          {{ claims.claimType | bilingualText }}
          <span *ngIf="claims.reissue">({{ 'OCCUPATIONAL-HAZARD.CLAIMS.RE-ISSUE CLAIM' | translate }})</span>
        </span>
      </ng-template>
    </div>
    <div class="header-wrapper col-md-auto mr-auto" accordion-heading>
      <div class="payee" *ngIf="claims && (claims.claimsPayee || claims.payeeDetails.payableTo?.english)">
        <span class="allowance-type"> {{ 'OCCUPATIONAL-HAZARD.CLAIMS.CLAIMS-PAYEE' | translate }}</span>

        <div class="currency claims-payee" *ngIf="claims.payeeDetails.payableTo.english === 'TPA'">
          {{ 'OCCUPATIONAL-HAZARD.TPA' | translate }} ({{ claims.payeeDetails.payeeName | bilingualText }})
        </div>
        <div
          class="currency claims-payee"
          *ngIf="claims.payeeDetails.payableTo.english === 'Contributor' && isAppPrivate"
        >
          <a class="select-link" (click)="navigateToContributor()"> {{ claims.payeeDetails.payeeId }}</a>
        </div>
        <div
          class="currency claims-payee"
          *ngIf="claims.payeeDetails.payableTo.english === 'Contributor' && !isAppPrivate"
        >
          <a class="select-link-inactive" (click)="navigateToContributor()"> {{ claims.payeeDetails.payeeId }}</a>
        </div>
        <div class="currency claims-payee" *ngIf="claims.payeeDetails.payableTo.english === 'Establishment'">
          <a class="select-link" (click)="navigateToEstProfile()"> {{ claims.payeeDetails.payeeId }}</a>
        </div>
        <div class="currency claims-payee" *ngIf="claims.payeeDetails.payableTo.english === 'Hospital'">
          {{ 'OCCUPATIONAL-HAZARD.ALLOWANCE.HOSPITAL-PAYEE' | translate }}
        </div>
        <div class="currency claims-payee" *ngIf="claims.payeeDetails.payableTo.english === 'Authorized Person'">
          {{ claims.payeeDetails.payableTo | bilingualText }}
        </div>
      </div>
    </div>
    <div
      [ngClass]="claims ? 'header-wrapper pl-2 ml-auto ' : 'header-wrapper pl-4 header-wrapper-allowance ml-auto'"
      accordion-heading
    >
      <ng-container *ngIf="!isReimSubPending || (isReimSubPending && !isRequested); else pendingRequest">
        <div
          *ngIf="paymentStatus"
          class="float-right status"
          [ngClass]="
            actualPaymentStatus?.english === 'Paid' ||
            actualPaymentStatus?.english === 'Approved' ||
            paymentStatus?.english === 'Approved' ||
            paymentStatus?.english === 'Partially Approved'
              ? 'allowance-view-completed'
              : actualPaymentStatus?.english === 'Hold' ||
                actualPaymentStatus?.english === 'Returned2' ||
                actualPaymentStatus?.english === 'Returned' ||
                actualPaymentStatus?.english === 'Awaiting Injury Approval' ||
                actualPaymentStatus?.english === 'Recovery in Progress' ||
                actualPaymentStatus?.english === 'Draft' ||
                actualPaymentStatus?.english === 'Bank Account verification in progress' ||
                actualPaymentStatus?.english === 'Awaiting parent claim approval' ||
                actualPaymentStatus?.english === 'Under Review' ||
                actualPaymentStatus?.english === 'Pending' ||
                actualPaymentStatus?.english === 'Authorized Person update Pending' ||
                paymentStatus?.english === 'Case under review' ||
                paymentStatus?.english === 'Received' ||
                paymentStatus?.english === 'Draft' ||
                paymentStatus?.english === 'Under Processing' ||
                paymentStatus?.english === 'Suspended' ||
                paymentStatus?.english === 'Pending'
              ? 'allowance-view-review'
              : actualPaymentStatus?.english === 'Rejected' ||
                actualPaymentStatus?.english === 'Recovered' ||
                actualPaymentStatus?.english === 'Overlapped' ||
                actualPaymentStatus?.english === 'Invalid Wage' ||
                actualPaymentStatus?.english === 'Injury Status Rejected' ||
                actualPaymentStatus?.english === 'Injury in Rejected Status' ||
                paymentStatus?.english === 'Case rejected' ||
                paymentStatus?.english === 'Denied'
              ? 'allowance-view-rejected'
              : actualPaymentStatus?.english === 'Cancelled'
              ? 'allowance-view-cancelled'
              : ''
          "
        >
          {{ paymentStatus | bilingualText | uppercase }}
        </div>
      </ng-container>
      <ng-template #pendingRequest>
        <div
          *ngIf="paymentStatus"
          class="float-right"
          [ngClass]="paymentStatus?.english === 'Requested' ? 'allowance-view-review' : ''"
        >
          {{ 'OCCUPATIONAL-HAZARD.IN-PROGRESS' | translate | uppercase }}
        </div>
      </ng-template>
      <span class="arrow-up">
        <fa-icon icon="chevron-up" size="2x"></fa-icon>
      </span>
      <span class="arrow-down" [ngClass]="allowances?.isDisabled && allowanceTab ? 'color' : ''">
        <fa-icon icon="chevron-down" size="2x"></fa-icon>
      </span>
    </div>
    <div class="accordion-details">
      <span *ngIf="claims; else allowanceComponent">
        <div class="row" *ngIf="actualPaymentStatus?.english === 'Overlapped'">
          <div
            class="col-lg-12 receipt-alert"
            *ngIf="
              (claims && claims?.claimType?.english === 'Companion Allowance') ||
              (claims && claims?.claimType?.english === 'Companion Daily Allowance')
            "
          >
            <gosi-alert-dc
              *ngIf="
                claims &&
                claims?.companionDetails &&
                (claims?.companionDetails?.startDate?.gregorian | date: 'dd/MM/yyyy') !==
                  (claims?.companionDetails?.endDate?.gregorian | date: 'dd/MM/yyyy')
              "
              [message]="
                'OCCUPATIONAL-HAZARD.COMPANION-PERIOD-PARTIAL-OVERLAP'
                  | translate
                    : {
                        StartDate: claims.companionDetails.startDate.gregorian | gosiDate,
                        InjuryId: claims.companionDetails.injuryIdList,
                        EndDate: claims.companionDetails.endDate.gregorian | gosiDate
                      }
              "
              [dismissible]="false"
              type="info"
            >
            </gosi-alert-dc>
            <gosi-alert-dc
              *ngIf="
                claims &&
                claims?.companionDetails &&
                (claims?.companionDetails?.endDate?.gregorian | date: 'dd/MM/yyyy') ===
                  (claims.companionDetails?.startDate?.gregorian | date: 'dd/MM/yyyy')
              "
              [message]="
                'OCCUPATIONAL-HAZARD.COMPANION-PERIOD-FULL-OVERLAP'
                  | translate
                    : {
                        StartDate: claims.companionDetails.startDate.gregorian | gosiDate,
                        EndDate: claims.companionDetails.endDate.gregorian | gosiDate,
                        InjuryId: claims.companionDetails.injuryIdList
                      }
              "
              type="info"
              [dismissible]="false"
            >
            </gosi-alert-dc>
          </div>
          <div
            class="col-lg-12 receipt-alert"
            *ngIf="
              (claims && claims?.claimType?.english === 'Companion Conveyance Allowance') ||
              claims?.claimType?.english === 'Conveyance Allowance'
            "
          >
            <gosi-alert-dc
              *ngIf="
                claims &&
                claims?.companionDetails &&
                (claims?.companionDetails?.startDate.gregorian | date: 'dd/MM/yyyy') !==
                  (claims.companionDetails?.endDate.gregorian | date: 'dd/MM/yyyy')
              "
              [message]="
                'OCCUPATIONAL-HAZARD.CONVEYANCE-PERIOD-PARTIAL-OVERLAP'
                  | translate
                    : {
                        StartDate: claims.companionDetails.startDate.gregorian | gosiDate,
                        EndDate: claims.companionDetails.endDate.gregorian | gosiDate,
                        InjuryId: claims.companionDetails.injuryIdList
                      }
              "
              type="info"
              [dismissible]="false"
            >
            </gosi-alert-dc>
            <gosi-alert-dc
              *ngIf="
                claims &&
                claims.companionDetails &&
                (claims?.companionDetails?.endDate?.gregorian | date: 'dd/MM/yyyy') ===
                  (claims?.companionDetails?.startDate?.gregorian | date: 'dd/MM/yyyy')
              "
              [message]="
                'OCCUPATIONAL-HAZARD.CONVEYANCE-PERIOD-FULL-OVERLAP'
                  | translate
                    : {
                        StartDate: claims.companionDetails.startDate.gregorian | gosiDate,
                        EndDate: claims.companionDetails.endDate.gregorian | gosiDate,
                        InjuryId: claims.companionDetails.injuryIdList
                      }
              "
              type="info"
              [dismissible]="false"
            >
            </gosi-alert-dc>
          </div>
        </div>
      </span>
      <ng-template #allowanceComponent>
        <div class="row" *ngIf="actualPaymentStatus?.english === 'Overlapped'">
          <div
            class="col-lg-12 receipt-alert"
            *ngIf="
              (allowances && allowances.allowanceType.english === 'InPatient Daily Allowance') ||
              allowances.allowanceType.english === 'OutPatient Daily Allowance' ||
              allowances.allowanceType.english === 'OutPatient Allowance' ||
              allowances.allowanceType.english === 'InPatient  Allowance'
            "
          >
            <gosi-alert-dc
              *ngIf="
                allowances &&
                (allowances.benefitStartDate.gregorian | date: 'dd/MM/yyyy') !==
                  (allowances.benefitEndDate.gregorian | date: 'dd/MM/yyyy')
              "
              [dismissible]="false"
              [message]="
                'OCCUPATIONAL-HAZARD.DAILY-ALLOWANCE-PARTIAL-OVERLAP'
                  | translate
                    : {
                        StartDate: allowances.benefitStartDate.gregorian | gosiDate,
                        EndDate: allowances.benefitEndDate.gregorian | gosiDate,
                        InjuryId: allowances.injuryIdList
                      }
              "
              type="info"
            >
            </gosi-alert-dc>
            <gosi-alert-dc
              *ngIf="
                allowances &&
                (allowances.benefitStartDate.gregorian | date: 'dd/MM/yyyy') ===
                  (allowances.benefitEndDate.gregorian | date: 'dd/MM/yyyy')
              "
              [message]="
                'OCCUPATIONAL-HAZARD.DAILY-ALLOWANCE-FULL-OVERLAP'
                  | translate
                    : {
                        StartDate: allowances.benefitStartDate.gregorian | gosiDate,
                        EndDate: allowances.benefitEndDate.gregorian | gosiDate,
                        InjuryId: allowances.injuryIdList
                      }
              "
              type="info"
              [dismissible]="false"
            >
            </gosi-alert-dc>
          </div>
          <div
            class="col-lg-12 receipt-alert"
            *ngIf="
              (allowances && allowances.allowanceType.english === 'Companion Allowance') ||
              (allowances && allowances.allowanceType.english === 'Companion Daily Allowance')
            "
          >
            <gosi-alert-dc
              *ngIf="
                allowances &&
                (allowances.benefitStartDate.gregorian | date: 'dd/MM/yyyy') !==
                  (allowances.benefitEndDate.gregorian | date: 'dd/MM/yyyy')
              "
              [dismissible]="false"
              [message]="
                'OCCUPATIONAL-HAZARD.COMPANION-PERIOD-PARTIAL-OVERLAP'
                  | translate
                    : {
                        StartDate: allowances.benefitStartDate.gregorian | gosiDate,
                        EndDate: allowances.benefitEndDate.gregorian | gosiDate,
                        InjuryId: allowances.injuryIdList
                      }
              "
              type="info"
            >
            </gosi-alert-dc>
            <gosi-alert-dc
              *ngIf="
                allowances &&
                (allowances.benefitEndDate.gregorian | date: 'dd/MM/yyyy') ===
                  (allowances.benefitStartDate.gregorian | date: 'dd/MM/yyyy')
              "
              type="info"
              [message]="
                'OCCUPATIONAL-HAZARD.COMPANION-PERIOD-FULL-OVERLAP'
                  | translate
                    : {
                        StartDate: allowances.benefitStartDate.gregorian | gosiDate,
                        EndDate: allowances.benefitEndDate.gregorian | gosiDate,
                        InjuryId: allowances.injuryIdList
                      }
              "
              [dismissible]="false"
            >
            </gosi-alert-dc>
          </div>
          <div
            class="col-lg-12 receipt-alert"
            *ngIf="
              (allowances && allowances.allowanceType.english === 'Companion Conveyance Allowance') ||
              allowances.allowanceType.english === 'Conveyance Allowance'
            "
          >
            <gosi-alert-dc
              *ngIf="
                allowances &&
                (allowances.benefitStartDate.gregorian | date: 'dd/MM/yyyy') !==
                  (allowances.benefitEndDate.gregorian | date: 'dd/MM/yyyy')
              "
              [dismissible]="false"
              [message]="
                'OCCUPATIONAL-HAZARD.CONVEYANCE-PERIOD-PARTIAL-OVERLAP'
                  | translate
                    : {
                        StartDate: allowances.benefitStartDate.gregorian | gosiDate,
                        EndDate: allowances.benefitEndDate.gregorian | gosiDate,
                        InjuryId: allowances.injuryIdList
                      }
              "
              type="info"
            >
            </gosi-alert-dc>
            <gosi-alert-dc
              *ngIf="
                allowances && allowances.allowanceType.english === 'Conveyance Allowance' && allowances?.injuryIdList[0]
              "
              [message]="
                'OCCUPATIONAL-HAZARD.CONVEYANCE-PERIOD-FULL-OVERLAP'
                  | translate
                    : {
                        StartDate: allowances.benefitStartDate.gregorian | gosiDate,
                        EndDate: allowances.benefitEndDate.gregorian | gosiDate,
                        InjuryId: allowances.injuryIdList
                      }
              "
              type="info"
              [dismissible]="false"
            >
            </gosi-alert-dc>
          </div>
          <div
            class="col-lg-12 receipt-alert"
            *ngIf="
              allowances &&
              (allowances.allowanceType.english === 'InPatient Daily Allowance Adjustment' ||
                allowances.allowanceType.english === 'OutPatient Daily Allowance Adjustment' ||
                allowances.allowanceType.english === 'Balance Settlement Adjustment Allowance' ||
                allowances.allowanceType.english === 'Balance Settlement Reversal Adjustment' ||
                allowances.allowanceType.english === 'Conveyance Allowance Adjustment') &&
              ((allowances.benefitStartDate.gregorian | date: 'dd/MM/yyyy') !==
                (allowances.startDate.gregorian | date: 'dd/MM/yyyy') ||
                (allowances.benefitEndDate.gregorian | date: 'dd/MM/yyyy') !==
                  (allowances.endDate.gregorian | date: 'dd/MM/yyyy'))
            "
          >
            <gosi-alert-dc
              *ngIf="
                allowances &&
                (allowances.benefitStartDate.gregorian | date: 'dd/MM/yyyy') !==
                  (allowances.benefitEndDate.gregorian | date: 'dd/MM/yyyy')
              "
              [message]="
                'OCCUPATIONAL-HAZARD.ADJUSTMENT-PARTIAL-OVERLAP'
                  | translate
                    : {
                        StartDate: allowances.benefitStartDate.gregorian | gosiDate,
                        EndDate: allowances.benefitEndDate.gregorian | gosiDate,
                        InjuryId: allowances.injuryIdList
                      }
              "
              type="info"
              [dismissible]="false"
            >
            </gosi-alert-dc>
            <gosi-alert-dc
              *ngIf="
                allowances &&
                (allowances.benefitStartDate.gregorian | date: 'dd/MM/yyyy') ===
                  (allowances.benefitEndDate.gregorian | date: 'dd/MM/yyyy')
              "
              [message]="
                'OCCUPATIONAL-HAZARD.ADJUSTMENT-FULL-OVERLAP'
                  | translate
                    : {
                        StartDate: allowances.benefitStartDate.gregorian | gosiDate,
                        EndDate: allowances.benefitEndDate.gregorian | gosiDate,
                        InjuryId: allowances.injuryIdList
                      }
              "
              type="info"
              [dismissible]="false"
            >
            </gosi-alert-dc>
          </div>
        </div>
      </ng-template>
      <ng-container *ngIf="claims; else allowanceDetails">
        <ng-container
          *ngIf="
            claims?.claimType?.english !== 'Companion Allowance' &&
            claims?.claimType?.english !== 'Companion Conveyance Allowance'
          "
        >
          <oh-expenses-calculation-dc
            [claims]="claims"
            [showDocs]="isReimSubPending && !isRequested && !isTpacompleted && showNewClaims ? true : false"
            [documents]="documents"
            [claimBreakUpList]="claimBreakUpList"
            (upload)="uploadDocuments($event)"
          >
          </oh-expenses-calculation-dc>
        </ng-container>
        <ng-container
          *ngIf="
            (claims?.claimType?.english === 'Companion Allowance' ||
              claims?.claimType?.english === 'Companion Conveyance Allowance') &&
            claims?.actualPaymentStatus?.english !== 'Overlapped'
          "
        >
          <oh-allowance-calculation-dc
            [allowances]="claims"
            [claimsIndicator]="true"
            [companionDetails]="claims.companionDetails"
            [calculationWrapper]="claims.calculationWrapper"
            [tabView]="true"
            [workDisabilityDate]="workDisabilityDate"
          >
          </oh-allowance-calculation-dc>
        </ng-container>
      </ng-container>
      <ng-template #allowanceDetails>
        <div *ngIf="allowances && allowances.actualPaymentStatus?.english !== 'Overlapped'">
          <oh-allowance-calculation-dc
            [allowances]="allowances"
            [companionDetails]="allowances.companionDetails"
            [calculationWrapper]="allowances.calculationWrapper"
            [contributorWage]="allowances.contributorWage"
            [day]="allowances.day"
            [workDisabilityDate]="workDisabilityDate"
          >
          </oh-allowance-calculation-dc>
        </div>
      </ng-template>
    </div>
  </accordion-group>
</accordion>
