<!--
  ~ Copyright GOSI. All Rights Reserved.
  ~  This software is the proprietary information of GOSI.
  ~  Use is subject to license terms.
-->
<div class="row engagement-period" *ngIf="engagement && engagement.engagementPeriod">
  <ng-container *ngFor="let engagementPeriod of engagement.engagementPeriod; let i = index">
    <!-- Accordian view for periods with timeline -->
    <div
      class="col-md-12 engagement-period-accordion timeline-section"
      [ngClass]="{
        active:
          (!engagement.leavingReason?.english && !engagementPeriod.endDate?.gregorian) ||
          (engagement.engagementType === typeVic && !engagement.leavingReason?.english),
        'only-1':
          (!engagement.leavingReason?.english &&
            !engagementPeriod.endDate?.gregorian &&
            engagement.engagementPeriod.length === 1) ||
          (engagement.engagementType === typeVic &&
            !engagement.leavingReason?.english &&
            engagement.engagementPeriod.length === 1)
      }"
    >
      <accordion>
        <accordion-group [isOpen]="i === 0">
          <!-- Accordion heading -->
          <span accordion-heading class="accordion-title">
            <ng-container
              *ngTemplateOutlet="periodHeader; context: { engagementPeriod: engagementPeriod }"
            ></ng-container
          ></span>
          <span accordion-heading class="chevron-right">
            <fa-icon icon="angle-up" class="icon-size" size="1x"></fa-icon>
          </span>
          <span accordion-heading class="chevron-left">
            <fa-icon icon="angle-up" class="icon-size" size="1x"></fa-icon>
          </span>
          <span accordion-heading class="chevron-down">
            <fa-icon icon="angle-down" class="icon-size"></fa-icon>
          </span>
          <!-- Accordion content section -->
          <div class="accordion-content">
            <!-- for Ppa engagements -->
            <div class="row company-worker-details">
              <div class="col-md-4" *ngIf="!isPpa && engagement.engagementType !== typeVic">
                <gosi-label-dc id="occupation" [control]="engagementPeriod?.occupation" label="CONTRIBUTOR.OCCUPATION">
                </gosi-label-dc>
              </div>
              <div class="col-md-4" *ngIf="isPpa">
                <gosi-label-dc id="jobClass" [control]="engagementPeriod?.jobClassName" label="CONTRIBUTOR.JOB-CLASS">
                </gosi-label-dc>
              </div>
              <div class="col-md-4" *ngIf="isPpa">
                <gosi-label-dc id="rank" [control]="engagementPeriod?.jobRankName" label="CONTRIBUTOR.RANK">
                </gosi-label-dc>
              </div>
              <div class="col-md-4" *ngIf="isPpa">
                <gosi-label-dc id="grade" [control]="engagementPeriod?.jobGradeName" label="CONTRIBUTOR.GRADE">
                </gosi-label-dc>
              </div>
            </div>
            <!-- Wage table section -->
            <cnt-wage-table-dc
              [isVic]="engagement.engagementType === typeVic"
              [purposeOfReg]="engagement.purposeOfRegistration"
              [engagementPeriod]="engagementPeriod"
              [joiningDate]="engagement?.joiningDate"
              [isPpa]="isPpa"
              [isPREligible]="isPREligible"
            ></cnt-wage-table-dc>
            <!-- Coverage and contributory icons -->
            <div>
              <cnt-coverage-contributory-wage-section-dc
                [displayIcon]="true"
                [engagementPeriod]="engagementPeriod"
                [isTotalShare]="true"
                [isVic]="engagement.engagementType === typeVic"
              ></cnt-coverage-contributory-wage-section-dc>
            </div>
          </div>
        </accordion-group>
      </accordion>
    </div>
  </ng-container>

  <!-- Mobile view for period section with timeline - (without accordian) -->
  <ng-container *ngFor="let engagementPeriod of engagement.engagementPeriod">
    <div
      class="col-md-12 engagement-periods timeline-section"
      [ngClass]="{
        active:
          (!engagement.leavingReason?.english && !engagementPeriod.endDate?.gregorian) ||
          (engagement.engagementType === typeVic && !engagement.leavingReason?.english),
        'only-1':
          (!engagement.leavingReason?.english &&
            !engagementPeriod.endDate?.gregorian &&
            engagement.engagementPeriod.length === 1) ||
          (engagement.engagementType === typeVic &&
            !engagement.leavingReason?.english &&
            engagement.engagementPeriod.length === 1)
      }"
    >
      <ng-container *ngTemplateOutlet="periodHeader; context: { engagementPeriod: engagementPeriod }"></ng-container>
      <div class="row">
        <div class="col-md-4" *ngIf="!engagement?.ppaIndicator">
          <gosi-label-dc
            id="occupation"
            [value]="engagementPeriod?.occupation | bilingualText"
            label="CONTRIBUTOR.OCCUPATION"
          ></gosi-label-dc>
        </div>
        <div class="col-md-4" *ngIf="engagement?.ppaIndicator">
          <gosi-label-dc
            id="job"
            [value]="engagementPeriod?.jobClassName | bilingualText"
            label="CONTRIBUTOR.JOB-CLASS"
          ></gosi-label-dc>
        </div>
        <div class="col-md-4" *ngIf="engagement?.ppaIndicator">
          <gosi-label-dc
            id="rank"
            [value]="engagementPeriod?.jobRankName | bilingualText"
            label="CONTRIBUTOR.RANK"
          ></gosi-label-dc>
        </div>
        <div class="col-md-4" *ngIf="engagement?.ppaIndicator">
          <gosi-label-dc
            id="job"
            [value]="engagementPeriod?.jobGradeName | bilingualText"
            label="CONTRIBUTOR.GRADE"
          ></gosi-label-dc>
        </div>
      </div>
      <div class="period-breakup">
        <cnt-wage-table-dc
          [isVic]="engagement.engagementType === typeVic"
          [purposeOfReg]="engagement.purposeOfRegistration"
          [engagementPeriod]="engagementPeriod"
          [joiningDate]="engagement?.joiningDate"
          [isPpa]="isPpa"
          [isPREligible]="isPREligible"
        ></cnt-wage-table-dc>
        <cnt-coverage-contributory-wage-section-dc
          [displayIcon]="true"
          [engagementPeriod]="engagementPeriod"
          [isVic]="engagement.engagementType === typeVic"
        ></cnt-coverage-contributory-wage-section-dc>
      </div>
    </div>
  </ng-container>
</div>

<!-- Period header template -->
<ng-template #periodHeader let-period="engagementPeriod">
  <div class="period-heading d-flex">
    <div>
      {{ period.startDate | dateType }}
      <span class="arrow-right px-2">
        <fa-icon icon="arrow-right"></fa-icon>
      </span>
      <span class="arrow-left px-2">
        <fa-icon icon="arrow-left"></fa-icon>
      </span>
      <ng-container *ngIf="period.endDate && period.endDate.gregorian && !isFutureEndingEngagement; else onwards">
        {{ period.endDate | dateType }}</ng-container
      >
    </div>
    <ng-template #onwards> {{ 'CONTRIBUTOR.ONWARDS' | translate }}</ng-template>
    <div id="duration" class="px-2">
      <ng-container *ngIf="period?.periodDuration?.noOfMonths || period?.periodDuration?.noOfDays">
        (
        <ng-container *ngIf="period?.periodDuration?.noOfMonths && period?.periodDuration?.noOfMonths !== 0">
          <ng-container
            *ngIf="
              !(lang === 'ar' && (period?.periodDuration?.noOfMonths === 1 || period?.periodDuration?.noOfMonths === 2))
            "
          >
            {{ period?.periodDuration?.noOfMonths }}
          </ng-container>
          {{
            period?.periodDuration?.noOfMonths === 1
              ? ('CONTRIBUTOR.WAGE.MONTH' | translate | titlecase)
              : period?.periodDuration?.noOfMonths === 2
              ? ('CONTRIBUTOR.WAGE.MONTHS' | translate | titlecase)
              : period?.periodDuration?.noOfMonths > 2 && period?.periodDuration?.noOfMonths < 11
              ? ('CONTRIBUTOR.WAGE.MONTHS-3-10' | translate | titlecase)
              : ('CONTRIBUTOR.WAGE.MONTHS-11' | translate | titlecase)
          }}
        </ng-container>
        <ng-container *ngIf="period?.periodDuration?.noOfMonths && period?.periodDuration?.noOfDays"> ,</ng-container>
        <ng-container *ngIf="period?.periodDuration?.noOfDays && period?.periodDuration?.noOfDays !== 0">
          <ng-container
            *ngIf="
              !(lang === 'ar' && (period?.periodDuration?.noOfDays === 1 || period?.periodDuration?.noOfDays === 2))
            "
          >
            {{ period?.periodDuration?.noOfDays }}
          </ng-container>
          {{
            period?.periodDuration?.noOfDays === 1
              ? ('CONTRIBUTOR.WAGE.DAY' | translate | titlecase)
              : period?.periodDuration?.noOfDays === 2
              ? ('CONTRIBUTOR.WAGE.DAYS' | translate | titlecase)
              : period?.periodDuration?.noOfDays > 2 && period?.periodDuration?.noOfDays < 11
              ? ('CONTRIBUTOR.WAGE.DAYS-3-10' | translate | titlecase)
              : ('CONTRIBUTOR.WAGE.DAYS-11' | translate | titlecase)
          }}
        </ng-container>
        <ng-container *ngIf="period?.contributorAbroad" class="engagement-seperator">
          {{ 'CONTRIBUTOR.ABROAD' | translate }}</ng-container
        >
        )
      </ng-container>

      <ng-container *ngIf="period?.periodOverlapping" class="overlap-position">
        <ng-template #overlapMessage>
          <span class="small-label"> {{ 'CONTRIBUTOR.OVERLAP-MSG' | translate }}</span>
        </ng-template>
        <img
          src="assets/icons/overlap.svg"
          placement="top"
          class="image-ppa"
          [tooltip]="overlapMessage"
          alt="annuity"
          (click)="imageClicked()"
        />
      </ng-container>
    </div>
  </div>
</ng-template>
