<!--
  ~ Copyright GOSI. All Rights Reserved.
  ~  This software is the proprietary information of GOSI.
  ~  Use is subject to license terms.
  -->

<div id="contributorSection" class="row">
  <div class="col-md-12">
    <frm-content-heading-dc icon="user" [heading]="'VIOLATIONS.CONTRIBUTOR-DETAILS' | translate" [canEdit]="false">
    </frm-content-heading-dc>
  </div>
</div>

<ng-container
  *ngIf="
    transactionDetails && transactionDetails?.contributors && transactionDetails?.contributors.length > 0;
    else noContributors
  "
>
  <div class="row">
    <div class="col-lg-12" *ngIf="transactionDetails?.showSaveError">
      <gosi-alert-dc
        [message]="'CORE.ERROR.MANDATORY-FIELDS'"
        type="danger"
        class="successMessage"
        noPadding="true"
        [dismissible]="false"
      >
      </gosi-alert-dc>
    </div>
  </div>
  <accordion *ngFor="let contributor of transactionDetails?.contributors; let i = index">
    <!-- isOpenChange method and accordionPanel === i + 1 is not added -->
    <accordion-group id="{{ i }}" class="accordion-group-class" [ngClass]="" [isOpen]="">
      <div accordion-heading (click)="resetInnerArrow()">
        <span class="name-value">
          {{
            contributor.contributorName.english === null || contributor.contributorName.english.trim() === ''
              ? contributor.contributorName.arabic
              : (contributor.contributorName | bilingualText)
          }}
        </span>

        <ng-container *ngIf="isSinNeeded(contributor.identity) === 1; else isSinValue">
          <div *ngFor="let identifier of contributor?.identity">
            <ng-container *ngIf="isSinNeeded(contributor.identity) === 1; else isSinValue">
              <div *ngIf="identifier?.idType === 'NIN'">
                <div class="identity-value">
                  {{ 'VIOLATIONS.NATIONAL-ID-NUMBER' | translate }} : {{ identifier?.newNin }}
                </div>
              </div>
              <div *ngIf="identifier?.idType === 'IQAMA'">
                <div class="identity-value">
                  {{ 'VIOLATIONS.IQAMA-NUMBER' | translate }} : {{ identifier?.iqamaNo }}
                </div>
              </div>
              <div *ngIf="identifier?.idType === 'GCCID'">
                <div class="identity-value">{{ 'VIOLATIONS.GCCID' | translate }} : {{ identifier?.id }}</div>
              </div>
            </ng-container>
          </div>
        </ng-container>
        <ng-template #isSinValue>
          <div class="identity-value">
            {{ 'VIOLATIONS.SOCIAL-INSURANCE-NO' | translate }} : {{ contributor?.socialInsuranceNo }}
          </div>
        </ng-template>
      </div>
      <div accordion-heading class="symbol-adjust">
        <span class="arrow-up-period arrow-color" accordion-heading>
          <span>
            <fa-icon class="icon-margin" icon="angle-up" size="lg"></fa-icon>
          </span>
        </span>
        <span class="arrow-down-period arrow-color" accordion-heading>
          <span>
            <fa-icon class="icon-margin" icon="angle-down" size="lg"></fa-icon>
          </span>
        </span>
      </div>
      <div class="row form-label">
        <div class="col-sm-12 col-md-6 col-lg-6">
          <ng-container *ngIf="isSinNeeded(contributor.identity) === 1; else isSinTemplate">
            <div *ngFor="let identifier of contributor?.identity">
              <ng-container *ngIf="isSinNeeded(contributor.identity) === 1; else isSinTemplate">
                <div *ngIf="identifier?.idType === 'NIN'">
                  <div class="identity-heading no-wrap title-label">
                    {{ 'VIOLATIONS.NATIONAL-ID-NUMBER' | translate }}
                  </div>
                  <a class="link-clr" (click)="navigateToProfile(i)"> {{ identifier?.newNin }} </a>
                </div>
                <div *ngIf="identifier?.idType === 'IQAMA'">
                  <div class="identity-heading no-wrap title-label">{{ 'VIOLATIONS.IQAMA-NUMBER' | translate }}</div>
                  <a class="link-clr" (click)="navigateToProfile(i)"> {{ identifier?.iqamaNo }} </a>
                </div>
                <div *ngIf="identifier?.idType === 'GCCID'">
                  <div class="identity-heading no-wrap title-label">{{ 'VIOLATIONS.GCCID' | translate }}</div>
                  <a class="link-clr" (click)="navigateToProfile(i)">
                    {{ identifier?.id }}
                  </a>
                </div>
              </ng-container>
            </div>
          </ng-container>
          <ng-template #isSinTemplate>
            <gosi-label-dc
              [label]="'VIOLATIONS.SOCIAL-INSURANCE-NO' | translate"
              [value]="contributor?.socialInsuranceNo"
              isLink="true"
              (select)="navigateToProfile(i)"
            ></gosi-label-dc>
          </ng-template>
        </div>
        <div class="col-sm-12 col-md-6 col-lg-6">
          <div class="identity-heading title-label">{{ 'VIOLATIONS.DOB' | translate }}</div>
          <div>
            <span>{{ contributor?.dateOfBirth?.gregorian | gosiDate }}</span>
            <span>({{ 'VIOLATIONS.AGE' | translate }}:{{ getAge(i) }})</span>
          </div>
        </div>
      </div>
      <!-- engagement section -->
      <div class="row engagement-details">
        <div class="col-md-12 mb-3 contribution-details" *ngIf="isCancelEngagement">
          {{ 'VIOLATIONS.CANCEL-ENGAGEMENT-DETAILS' | translate }}
        </div>
        <div
          class="col-md-12 mb-3 contribution-details"
          *ngIf="!isCancelEngagement && !isWrongBenefits && !isViolatingProvision"
        >
          {{ 'VIOLATIONS.ENGAGEMENT-DETAILS' | translate }}
        </div>
      </div>
      <ng-container *ngIf="!(isWrongBenefits || isViolatingProvision)">
        <accordion *ngFor="let engagement of contributor?.engagementInfo; let j = index">
          <accordion-group class="accordion-group-class-inner" [isOpen]="false" [isDisabled]="isIncorrectWage">
            <div accordion-heading>
              <div *ngIf="!isCancelEngagement" [ngClass]="!isCancelEngagement ? 'period-section' : ''">
                <span class="name-value">
                  {{ engagement?.joiningDate | dateType | formatDate }}
                  <fa-icon class="value-clrs" *ngIf="lang === 'en'" icon="arrow-right"></fa-icon>
                  <fa-icon class="value-clrs" *ngIf="lang === 'ar'" icon="arrow-left"></fa-icon>
                  <ng-container
                    *ngIf="engagement?.terminationDate?.gregorian || engagement?.terminationDate?.hijiri; else onwards"
                  >
                    {{ engagement?.terminationDate | dateType | formatDate }}
                  </ng-container>
                </span>
                <ng-container>
                  <div
                    class="engagement-duration"
                    *ngIf="engagement?.engagementPeriodMonth || engagement?.engagementPeriodDays"
                  >
                    <!-- duration -->
                    (
                    <span *ngIf="engagement?.engagementPeriodMonth && engagement?.engagementPeriodMonth !== 0">
                      <span>
                        {{ engagement?.engagementPeriodMonth }}
                      </span>

                      {{
                        engagement?.engagementPeriodMonth >= 3 && engagement?.engagementPeriodMonth <= 10
                          ? ('VIOLATIONS.MONTHS-3-10' | translate | titlecase)
                          : engagement?.engagementPeriodMonth === 1
                          ? ('VIOLATIONS.MONTH' | translate | titlecase)
                          : engagement?.engagementPeriodMonth === 2
                          ? ('VIOLATIONS.MONTHS' | translate | titlecase)
                          : ('VIOLATIONS.MONTHS-11' | translate | titlecase)
                      }}
                    </span>
                    <!-- after displaying month if there is days comma will be displayed -->
                    <span *ngIf="engagement?.engagementPeriodMonth && engagement?.engagementPeriodDays"> ,</span>
                    <span *ngIf="engagement?.engagementPeriodDays && engagement?.engagementPeriodDays !== 0">
                      <span *ngIf="engagement?.engagementPeriodDays">
                        {{ engagement?.engagementPeriodDays }}
                      </span>

                      {{
                        engagement?.engagementPeriodDays === 2
                          ? ('VIOLATIONS.DAYS' | translate | titlecase)
                          : engagement?.engagementPeriodDays === 1
                          ? ('VIOLATIONS.DAY' | translate | titlecase)
                          : engagement?.engagementPeriodDays > 2 && engagement?.engagementPeriodDays < 11
                          ? ('VIOLATIONS.DAYS-3-10' | translate | titlecase)
                          : ('VIOLATIONS.DAYS-11' | translate | titlecase)
                      }}
                    </span>
                    )
                  </div>
                </ng-container>
              </div>
              <!-- for CE violation type -->
              <div *ngIf="isCancelEngagement">
                <span class="name-value">
                  {{ engagement?.cancelledDurationStartDate | dateType | formatDate }}
                  <fa-icon class="value-clrs" *ngIf="lang === 'en'" icon="arrow-right"></fa-icon>
                  <fa-icon class="value-clrs" *ngIf="lang === 'ar'" icon="arrow-left"></fa-icon>
                    {{ engagement?.cancelledDurationEndDate | dateType | formatDate }}
                </span>
                <ng-container>
                  <div
                    class="engagement-duration"
                    *ngIf="engagement?.cancelledEngDuration?.months || engagement?.cancelledEngDuration?.days"
                  >
                    <!-- duration -->
                    (
                    <span *ngIf="engagement?.cancelledEngDuration?.months && engagement?.cancelledEngDuration?.months !== 0">
                      <span>
                        {{ engagement?.cancelledEngDuration?.months }}
                      </span>

                      {{
                        engagement?.cancelledEngDuration?.months >= 3 && engagement?.cancelledEngDuration?.months <= 10
                          ? ('VIOLATIONS.MONTHS-3-10' | translate | titlecase)
                          : engagement?.cancelledEngDuration?.months === 1
                          ? ('VIOLATIONS.MONTH' | translate | titlecase)
                          : engagement?.cancelledEngDuration?.months === 2
                          ? ('VIOLATIONS.MONTHS' | translate | titlecase)
                          : ('VIOLATIONS.MONTHS-11' | translate | titlecase)
                      }}
                    </span>
                    <!-- after displaying month if there is days comma will be displayed -->
                    <span *ngIf="engagement?.cancelledEngDuration?.months && engagement?.cancelledEngDuration?.days"> ,</span>
                    <span *ngIf="engagement?.cancelledEngDuration?.days && engagement?.cancelledEngDuration?.days !== 0">
                      <span *ngIf="engagement?.cancelledEngDuration?.days">
                        {{ engagement?.cancelledEngDuration?.days }}
                      </span>

                      {{
                        engagement?.cancelledEngDuration?.days === 2
                          ? ('VIOLATIONS.DAYS' | translate | titlecase)
                          : engagement?.cancelledEngDuration?.days === 1
                          ? ('VIOLATIONS.DAY' | translate | titlecase)
                          : engagement?.cancelledEngDuration?.days > 2 && engagement?.cancelledEngDuration?.days < 11
                          ? ('VIOLATIONS.DAYS-3-10' | translate | titlecase)
                          : ('VIOLATIONS.DAYS-11' | translate | titlecase)
                      }}
                    </span>
                    )
                  </div>
                </ng-container>
              </div>
              <!--  -->
            </div>
            <span class="contri-amount arrow-color" accordion-heading *ngIf="isCancelEngagement">
              <span class="ml-2 mr-2">
                <span class="exclude-value">
                  {{ 'VIOLATIONS.CONTRIBUTION' | translate }} :
                  <span class="contribution-amount">
                    {{ engagement?.contributionAmount | number: '1.2-2' }}
                    {{ 'VIOLATIONS.CURRENCY' | translate }}
                  </span>
                  <!-- contribution amount -->
                </span>
              </span>
            </span>
            <div accordion-heading class="symbol-adjust" (click)="changeArrow()" *ngIf="!isIncorrectWage">
              <span class="inner-arrow-up-period arrow-color" accordion-heading>
                <span>
                  <fa-icon class="icon-margin" icon="angle-up" size="lg"></fa-icon>
                </span>
              </span>
              <span class="inner-arrow-down-period arrow-color" accordion-heading>
                <span>
                  <fa-icon class="icon-margin" icon="angle-down" size="lg"></fa-icon>
                </span>
              </span>
            </div>
            <ng-container>
              <!-- engagement content -->
              <div class="row form-label">
                <!-- add ng if for violation type -->
                <!-- eng content for CE -->
                <ng-container *ngIf="isCancelEngagement">
                  <div class="col-sm-12 col-md-6 col-lg-6">
                    <gosi-label-dc
                      [label]="'VIOLATIONS.IS-THE-FULL-ENGAGEMENT-CANCELLED' | translate"
                      [control]="engagement?.isEngagementFullyCanceled"
                    ></gosi-label-dc>
                  </div>
                </ng-container>
                <!--  IN CASE OF IRT -->
                <ng-container *ngIf="isIncorrectReason">
                  <div class="col-sm-12 col-md-6 col-lg-6">
                    <gosi-label-dc
                      [label]="'VIOLATIONS.LEAVING-REASON' | translate"
                      [control]="engagement?.terminationReason"
                    ></gosi-label-dc>
                  </div>
                  <div class="col-sm-12 col-md-6 col-lg-6">
                    <gosi-label-dc
                      [label]="'VIOLATIONS.IS-REASON-EFFECTED-BENEFIT' | translate"
                      [control]="engagement?.isBenefitsEffected"
                    ></gosi-label-dc>
                  </div>
                </ng-container>
                <!-- IN CASE OF ADD NEW -->
                <div class="col-sm-12 col-md-6 col-lg-6" *ngIf="isAddNewEngagement">
                  <gosi-label-dc
                    [label]="'VIOLATIONS.IS-ENG-ADDED-BACKDATED' | translate"
                    [control]="engagement?.isBackdated"
                  ></gosi-label-dc>
                </div>
              </div>
            </ng-container>
          </accordion-group>
        </accordion>
        <ng-template #onwards> {{ 'VIOLATIONS.ONWARDS' | translate }} </ng-template>
      </ng-container>
      <!-- wrong benefits engagement section -->
      <div class="row mt-4 mb-2" *ngIf="isWrongBenefits || isViolatingProvision">
        <div class="col-sm-12 col-md-12 col-lg-12 mb-2">
          <span class="identity-heading">{{ 'VIOLATIONS.ENGAGEMENT-CONTRIBUTED-BENEFITS' | translate }}</span>
        </div>
        <table class="table othervio">
          <thead class="thead multiple-header">
            <tr>
              <th id="eng-period">{{ 'VIOLATIONS.ENGAGEMENT-PERIOD' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr class="border-bottom" *ngFor="let engagement of contributor?.engagementInfo">
              <td class="table-othervio">
                <span class="name-value">
                  {{
                    (getDateType(engagement?.joiningDate?.entryFormat) === 'Hijiri'
                      ? engagement?.joiningDate?.hijiri
                      : engagement?.joiningDate?.gregorian
                    ) | gosiDate
                  }}
                  <fa-icon class="value-clrs" *ngIf="lang === 'en'" icon="arrow-right"></fa-icon>
                  <fa-icon class="value-clrs" *ngIf="lang === 'ar'" icon="arrow-left"></fa-icon>
                  <ng-container
                    *ngIf="engagement?.terminationDate?.gregorian || engagement?.terminationDate?.hijiri; else onwards"
                  >
                    {{
                      (getDateType(engagement?.terminationDate?.entryFormat) === 'Hijiri'
                        ? engagement?.terminationDate?.hijiri
                        : engagement?.terminationDate?.gregorian
                      ) | gosiDate
                    }}
                  </ng-container>
                </span>
                <ng-container>
                  <div
                    class="engagement-duration"
                    *ngIf="engagement?.engagementPeriodMonth || engagement?.engagementPeriodDays"
                  >
                    <!-- duration -->
                    (
                    <span *ngIf="engagement?.engagementPeriodMonth && engagement?.engagementPeriodMonth !== 0">
                      <span>
                        {{ engagement?.engagementPeriodMonth }}
                      </span>

                      {{
                        engagement?.engagementPeriodMonth >= 3 && engagement?.engagementPeriodMonth <= 10
                          ? ('VIOLATIONS.MONTHS-3-10' | translate | titlecase)
                          : engagement?.engagementPeriodMonth === 1
                          ? ('VIOLATIONS.MONTH' | translate | titlecase)
                          : engagement?.engagementPeriodMonth === 2
                          ? ('VIOLATIONS.MONTHS' | translate | titlecase)
                          : ('VIOLATIONS.MONTHS-11' | translate | titlecase)
                      }}
                    </span>
                    <!-- after displaying month if there is days comma will be displayed -->
                    <span *ngIf="engagement?.engagementPeriodMonth && engagement?.engagementPeriodDays"> ,</span>
                    <span *ngIf="engagement?.engagementPeriodDays && engagement?.engagementPeriodDays !== 0">
                      <span *ngIf="engagement?.engagementPeriodDays">
                        {{ engagement?.engagementPeriodDays }}
                      </span>

                      {{
                        engagement?.engagementPeriodDays === 2
                          ? ('VIOLATIONS.DAYS' | translate | titlecase)
                          : engagement?.engagementPeriodDays === 1
                          ? ('VIOLATIONS.DAY' | translate | titlecase)
                          : engagement?.engagementPeriodDays > 2 && engagement?.engagementPeriodDays < 11
                          ? ('VIOLATIONS.DAYS-3-10' | translate | titlecase)
                          : ('VIOLATIONS.DAYS-11' | translate | titlecase)
                      }}
                    </span>
                    )
                  </div>
                  <ng-template #onwards> {{ 'VIOLATIONS.ONWARDS' | translate }} </ng-template>
                </ng-container>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- Benefit details section -->
      <div class="row mt-2 mb-2" *ngIf="isWrongBenefits && contributor?.benefitInfo[0]">
        <div class="col-sm-12 col-md-12 col-lg-12 mt-2 mb-1 benefit-label">
          <span class="identity-heading benefit-heading">{{ 'VIOLATIONS.BENEFIT-DETAILS' | translate }}</span>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12">
        <table class="table-benefit">
          <thead class="thead multiple-header">
            <tr class="heading">
              <th id="benefit-type" class="heading-values">
                {{ 'VIOLATIONS.BENEFIT-TYPE' | translate }}
              </th>
              <th id="benefit-amount" class="heading-values">
                {{ 'VIOLATIONS.BENEFIT-AMOUNT' | translate }}
              </th>
              <!-- <th id="benefit-duration" class="heading-values">
                {{ 'VIOLATIONS.BENEFIT-DURATION' | translate }}
              </th>
              <th id="last-benefit-date" class="heading-values">
                {{ 'VIOLATIONS.LAST-BENEFIT-DATE' | translate }}
              </th> -->
            </tr>
          </thead>
          <tbody class="tbody">
            <tr class="border-bottom" *ngFor="let benefit of contributor?.benefitInfo">
              <td class="benefit-value">
                <div class="row ml-2 mr-2 benefit-type-period">
                  <div class="benefit-type-section">{{ benefit?.benefitType | bilingualText }}</div>
                  <div class="benefit-period-section">
                    {{benefit?.firstPaymentDate?.gregorian | gosiDate }} 
                    <fa-icon class="value-clrs" *ngIf="lang === 'en'" icon="arrow-right"></fa-icon>
                    <fa-icon class="value-clrs" *ngIf="lang === 'ar'" icon="arrow-left"></fa-icon> {{benefit?.lastBenefitDate?.gregorian | gosiDate }}
                    ({{benefit?.benefitDuration}} 
                    {{
                      benefit?.benefitDuration === 1
                            ? ('VIOLATIONS.BENEFIT-MONTH' | translate )
                            : benefit?.benefitDuration === 2
                            ? ('VIOLATIONS.BENEFIT-MONTHS-2' | translate )
                            : (benefit?.benefitDuration > 2 && benefit?.benefitDuration < 11) 
                            ? ('VIOLATIONS.BENEFIT-MONTHS-3-10' | translate )
                            : ('VIOLATIONS.BENEFIT-MONTHS-11' | translate ) 
                    }}) 
                  </div>
                </div>
              </td>
              <td class="amount-currency">
                <span> {{ benefit?.benefitAmount | number: '1.2-2' }} </span>
                <span class="benefit-currency-label">
                  <span>{{ 'VIOLATIONS.CURRENCY' | translate }}</span>
                  <span>{{
                    checkIfLumpsum(benefit?.benefitType.english) ? '' : ('VIOLATIONS.PER-MONTH' | translate)
                  }}</span>
                </span>
              </td>
              <!-- <td>
                {{ benefit?.benefitDuration }}
              </td>
              <td>
                {{ benefit?.lastBenefitDate?.gregorian | gosiDate }}
              </td> -->
            </tr>
          </tbody>
        </table>
        </div>
        <div class="col-sm-12 col-md-12 col-lg-12 mt-4 total-benefit-amount">
          <div class="row mb-4 mt-2">
            <div class="col-sm-12 col-md-12 col-lg-12 benefit-amount-label">
              {{ 'VIOLATIONS.TOTAL-BENEFIT-AMOUNT' | translate }}
            </div>
            <div class="col-sm-12 col-md-12 col-lg-12 benefit-amount-value">
              <span>{{ contributor?.totalBenefitAmount | number: '1.2-2' }}</span>
              <span class="benefit-currency">{{ 'VIOLATIONS.CURRENCY' | translate }}</span>
            </div>
          </div>
        </div>
      </div>
      <!--  -->
    </accordion-group>
  </accordion>
</ng-container>
<ng-template #noContributors>
  <div class="row">
    <div class="col-sm-12 col-md-12 col-g-6">
      <gosi-alert-dc
        [bilingualMessage]="'VIOLATIONS.NO-CONTRIBUTORS-ADDED' | translate"
        type="info"
        [dismissible]="false"
        [noPadding]="false"
      >
      </gosi-alert-dc>
    </div>
  </div>
</ng-template>
