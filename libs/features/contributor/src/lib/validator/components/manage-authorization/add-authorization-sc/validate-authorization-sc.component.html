<!--
  ~ Copyright GOSI. All Rights Reserved.
  ~  This software is the proprietary information of GOSI.
  ~  Use is subject to license terms.
  -->

<div class="content">
  <frm-main-content-dc [comments]="comments" [documents]="documents">
    <div id="mainHeading">
      <frm-main-heading-dc [heading]="'CONTRIBUTOR.ADD-AUTHORIZATION.ADD-AUTHORIZATION' | translate">
      </frm-main-heading-dc>
    </div>

    <div id="contentArea">
      <!-- Authorized details -->
      <div class="content-item" *ngIf="authorizedPerson">
        <frm-content-heading-dc
          icon="user"
          [canEdit]="canEdit && isEditable"
          [heading]="'CONTRIBUTOR.PERSONAL-DETAILS'"
          (onEdit)="navigateToEdit()"
        >
        </frm-content-heading-dc>

        <div class="row">
          <div class="col-sm-12 col-md-6 col-lg-6">
            <gosi-label-dc
              id="contributorName"
              [control]="authorizedPersonName.arabic"
              [label]="
                (isAttorney
                  ? 'CONTRIBUTOR.ADD-AUTHORIZATION.ATTORNEY-NAME'
                  : 'CONTRIBUTOR.ADD-AUTHORIZATION.CUSTODIAN-NAME'
                ) | translate
              "
            ></gosi-label-dc>
          </div>
          <div class="col-sm-12 col-md-6 col-lg-6">
            <gosi-label-dc
              id="contributorName"
              [control]="authorizedPersonName.english"
              [label]="
                (isAttorney
                  ? 'CONTRIBUTOR.ADD-AUTHORIZATION.ATTORNEY-NAME'
                  : 'CONTRIBUTOR.ADD-AUTHORIZATION.CUSTODIAN-NAME'
                ) | translate
              "
            ></gosi-label-dc>
          </div>
          <div class="col-sm-12 col-md-6 col-lg-6">
            <gosi-label-dc
              id="personNationalID"
              [control]="authorizedPersonIdentity.id"
              [label]="'CONTRIBUTOR.' + authorizedPersonIdentity.idType | translate"
            ></gosi-label-dc>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 col-md-6 col-lg-6">
            <gosi-label-dc
              id="contributorNationality"
              [control]="authorizedPerson.nationality | bilingualText"
              [label]="'CONTRIBUTOR.NATIONALITY'"
            ></gosi-label-dc>
          </div>
          <div class="col-sm-12 col-md-6 col-lg-6">
            <gosi-label-dc
              id="contributorDOB"
              [control]="gregorianBirthDate(authorizedPerson.birthDate) | bilingualText"
              [label]="'CONTRIBUTOR.DATE-OF-BIRTH'"
            ></gosi-label-dc>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 col-md-6 col-lg-6">
            <gosi-label-dc
              id="contributorGender"
              [control]="authorizedPerson.sex | bilingualText"
              [label]="'CONTRIBUTOR.GENDER'"
            ></gosi-label-dc>
          </div>
          <div class="col-sm-12 col-md-6 col-lg-6">
            <gosi-label-dc
              id="contributorDOBHijri"
              [control]="hijriBirthDate(authorizedPerson.birthDate, authorizedPerson.ageInHijiri) | bilingualText"
              [label]="'CONTRIBUTOR.DATE-OF-BIRTH-HIJRI'"
            ></gosi-label-dc>
          </div>
        </div>
      </div>

      <!-- Contact Details -->
      <div class="content-item">
        <gosi-card-dc
          *ngIf="authorizedPersonContactDetails"
          type="secondary"
          heading="{{ 'FORM-FRAGMENTS.CONTACT-DETAILS' | translate }}"
          noPadding="true"
        >
          <div class="row">
            <div *ngIf="authorizedPersonContactDetails.telephoneNo?.primary" class="col-sm-6 col-md-6 col-lg-6">
              <gosi-label-dc
                id="telephoneNumber"
                [control]="authorizedPersonContactDetails.telephoneNo?.primary"
                label="FORM-FRAGMENTS.TELEPHONE-NUMBER"
              ></gosi-label-dc>
            </div>
            <div *ngIf="authorizedPersonContactDetails.telephoneNo?.primary" class="col-sm-6 col-md-6 col-lg-6">
              <gosi-label-dc
                id="extension"
                [control]="authorizedPersonContactDetails.telephoneNo?.extensionPrimary"
                label="FORM-FRAGMENTS.EXTENSION"
              ></gosi-label-dc>
            </div>
            <div class="col-sm-6 col-md-6 col-lg-6">
              <gosi-label-dc
                id="mobileNumber"
                [control]="authorizedPersonContactDetails.mobileNo?.primary"
                label="FORM-FRAGMENTS.MOBILE-NUMBER"
              >
                <span id="prefixValue">
                  {{ authorizedPersonContactDetails.mobileNo?.isdCodePrimary ? getISDCodePrefix : '' }}
                </span>
              </gosi-label-dc>
            </div>
            <div class="col-sm-6 col-md-6 col-lg-6">
              <gosi-label-dc
                id="emailAddress"
                [control]="authorizedPersonContactDetails.emailId?.primary"
                label="FORM-FRAGMENTS.EMAIL-ID"
              >
              </gosi-label-dc>
            </div>
          </div>
        </gosi-card-dc>
      </div>

      <!-- Address Details -->
      <div class="content-item">
        <frm-address-dc
          *ngIf="authorizedPersonContactDetails?.addresses"
          [addressDetails]="authorizedPersonContactDetails.addresses"
          [isViewOnly]="true"
          [hasNationalAddress]="hasNationalAddress"
          [hasPOAddress]="hasPOAddress"
          [hasOverseasAddress]="hasOverseasAddress"
          [currentMailingAddress]="authorizedPersonContactDetails.currentMailingAddress"
        >
        </frm-address-dc>
      </div>

      <!-- Bank Details -->
      <div class="content-item" *ngIf="bankAccount">
        <gosi-card-dc
          type="secondary"
          heading="{{ 'FORM-FRAGMENTS.BANK-ACCOUNT-DETAILS' | translate }}"
          noPadding="true"
        >
          <gosi-alert-dc
            [alert]="ibanPendingVerificationAlert"
            *ngIf="bankAccount.approvalStatus === 'Sama Verification Pending'"
          ></gosi-alert-dc>
          <div class="row">
            <div class="col-sm-6 col-md-6 col-lg-6">
              <gosi-label-dc
                id="iban"
                [control]="bankAccount.ibanBankAccountNo"
                label="FORM-FRAGMENTS.IBANACCOUNT-NUMBER"
              ></gosi-label-dc>
            </div>
            <div class="col-sm-12 col-md-6 col-lg-6">
              <gosi-label-dc
                id="bankName"
                [control]="bankAccount.bankName | bilingualText"
                [label]="'FORM-FRAGMENTS.BANK-NAME' | translate"
              ></gosi-label-dc>
            </div>
          </div>
        </gosi-card-dc>
      </div>

      <!-- Authorization Details -->
      <div class="content-item" *ngIf="authorizationDetails">
        <frm-content-heading-dc icon="users" [canEdit]="false" [heading]="'CONTRIBUTOR.ADD-AUTHORIZATION.DETAILS'">
        </frm-content-heading-dc>

        <div class="row">
          <div class="col-sm-12 col-md-6 col-lg-6">
            <gosi-label-dc
              id="countryOfIssue"
              [control]="authorizationDetails.countryOfIssue | bilingualText"
              [label]="'CONTRIBUTOR.ADD-AUTHORIZATION.COUNTRY-OF-ISSUE' | translate"
            ></gosi-label-dc>
          </div>
          <div class="col-sm-12 col-md-6 col-lg-6">
            <gosi-label-dc
              *ngIf="isAttorney"
              id="authIssueDate"
              [control]="authorizationDetails.issueDate.gregorian | date: 'dd/MM/yyyy'"
              [label]="'CONTRIBUTOR.ADD-AUTHORIZATION.ISSUE-DATE' | translate"
            ></gosi-label-dc>
            <gosi-label-dc
              *ngIf="!isAttorney"
              id="authIssueDate"
              [control]="authorizationDetails.custodyDate.gregorian | date: 'dd/MM/yyyy'"
              [label]="'CONTRIBUTOR.ADD-AUTHORIZATION.CUSTODY.ISSUE-DATE' | translate"
            ></gosi-label-dc>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 col-md-6 col-lg-6" *ngIf="authPurpose">
            <gosi-label-dc
              id="authPurpose"
              [control]="authPurpose | bilingualText"
              [label]="'CONTRIBUTOR.ADD-AUTHORIZATION.ATTORNEY.PURPOSE'"
            ></gosi-label-dc>
          </div>
          <div class="col-sm-12 col-md-6 col-lg-6" *ngIf="isAttorney">
            <gosi-label-dc
              id="authEndDate"
              [control]="authorizationDetails.endDate.gregorian | date: 'dd/MM/yyyy'"
              [label]="'CONTRIBUTOR.ADD-AUTHORIZATION.EXPIRY-DATE' | translate"
            ></gosi-label-dc>
          </div>
        </div>
        <div class="row" *ngIf="isMOJ">
          <div class="col-sm-12 col-md-6 col-lg-6">
            <gosi-label-dc
              id="authNumber"
              [control]="isAttorney ? authorizationDetails.attorneyNumber : authorizationDetails.custodyNumber"
              [label]="
                (isAttorney
                  ? 'CONTRIBUTOR.ADD-AUTHORIZATION.AUTHORIZATION-NUMBER'
                  : 'CONTRIBUTOR.ADD-AUTHORIZATION.CUSTODY-NUMBER'
                ) | translate
              "
            ></gosi-label-dc>
          </div>
        </div>
        <div class="row" *ngIf="isMOJ">
          <div class="col-md-8" id="authText" *ngIf="isAttorney">
            <gosi-input-text-area-dc
              [control]="authText"
              [hideOptionalLabel]="true"
              [label]="'CONTRIBUTOR.ADD-AUTHORIZATION.ATTORNEY.TEXT' | translate"
              [readOnly]="true"
            >
            </gosi-input-text-area-dc>
          </div>
          <div class="form-group col-md-auto" *ngIf="!isAttorney">
            <label>
              {{ 'CONTRIBUTOR.ADD-AUTHORIZATION.CUSTODY.TEXT' | translate }}
            </label>
            <div class="row custody-text-frame">
              <iframe #custodyTextIframe width="800" height="500" src="about:blank"></iframe>
            </div>
          </div>
        </div>
      </div>

      <!-- Authorizer Person Details -->
      <gosi-card-dc
        *ngIf="authorizerList"
        type="secondary"
        heading="{{
          (isAttorney
            ? 'CONTRIBUTOR.ADD-AUTHORIZATION.AUTHORIZER-DETAILS'
            : 'CONTRIBUTOR.ADD-AUTHORIZATION.MINOR-DETAILS'
          ) | translate
        }}"
        noPadding="true"
      >
        <div class="desktop-view-table authorizer-list-table">
          <gosi-table-dc>
            <ng-container modalContent>
              <table aria-describedby="title" class="table">
                <thead>
                  <tr>
                    <th id="name">
                      {{
                        (isAttorney
                          ? 'CONTRIBUTOR.ADD-AUTHORIZATION.AUTHORIZER-NAME'
                          : 'CONTRIBUTOR.ADD-AUTHORIZATION.CUSTODY.MINOR.NAME'
                        ) | translate
                      }}
                    </th>
                    <th id="nId">
                      {{ 'CONTRIBUTOR.ADD-AUTHORIZATION.ID' | translate }}
                    </th>
                    <th id="nationality">
                      {{ 'CONTRIBUTOR.NATIONALITY' | translate }}
                    </th>
                    <th id="dob">
                      {{ 'CONTRIBUTOR.DATE-OF-BIRTH' | translate }}
                    </th>
                    <th id="gender">
                      {{ 'CONTRIBUTOR.GENDER' | translate }}
                    </th>
                    <th id="minorType" *ngIf="!isAttorney">
                      {{ 'CONTRIBUTOR.ADD-AUTHORIZATION.CUSTODY.MINOR.TYPE' | translate }}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of authorizerList; let i = index">
                    <td>
                      {{ item.fullName }}
                    </td>
                    <td>
                      {{ item.id }}
                    </td>
                    <td>
                      {{ item.nationality | bilingualText }}
                    </td>
                    <td>
                      <div>{{ gregorianBirthDate(item.dateOfBirth) | bilingualText }}</div>
                      <div>{{ hijriBirthDate(item.dateOfBirth, item.ageInHijiri) | bilingualText }}</div>
                    </td>
                    <td>
                      {{ item.sex | bilingualText }}
                    </td>
                    <td *ngIf="!isAttorney">
                      {{
                        (item.minorType === 0
                          ? 'CONTRIBUTOR.ADD-AUTHORIZATION.CUSTODY.MINOR.AGE-MINOR'
                          : 'CONTRIBUTOR.ADD-AUTHORIZATION.CUSTODY.MINOR.MENTALLY-MINOR'
                        ) | translate
                      }}
                    </td>
                  </tr>
                </tbody>
              </table>
            </ng-container>
          </gosi-table-dc>
        </div>
      </gosi-card-dc>
    </div>

    <!-- Action area -->
    <div id="actionArea">
      <frm-action-area-dc
        [canReturn]="canReturn"
        [canReject]="canReject"
        [isReturn]="false"
        [isValidatorShow]="isValidatorShow"
        (approveEvent)="showModal(approveTemplate)"
        (rejectEvent)="showModal(rejectTemplate)"
        (returnEvent)="showModal(returnTemplate)"
        (cancelEvent)="navigateToInbox()"
      >
      </frm-action-area-dc>
    </div>
  </frm-main-content-dc>
</div>

<!-- Modals -->

<ng-template #approveTemplate>
  <frm-approve-template-dc
    [parentForm]="validatorForm"
    [infoMessage]="isBeneficiary ? 'CONTRIBUTOR.INFO-VALIDATOR-BENEFICIARY' : null"
    (cancelEvent)="hideModal()"
    (approveEvent)="handleWorkflowEvents(0)"
  ></frm-approve-template-dc>
</ng-template>

<ng-template #rejectTemplate>
  <frm-reject-template-dc
    [parentForm]="validatorForm"
    [heading]="'CONTRIBUTOR.ADD-AUTHORIZATION.REJECT-ADD-AUTHORIZATION'"
    warningMessage="CONTRIBUTOR.ADD-AUTHORIZATION.INFO-VALIDATOR-REJECTION"
    [transactionNumber]="referenceNo"
    [rejectReasonList$]="rejectReasonList$"
    (cancelEvent)="hideModal()"
    (rejectEvent)="handleWorkflowEvents(1)"
  >
  </frm-reject-template-dc>
</ng-template>

<ng-template #returnTemplate>
  <frm-return-template-dc
    [parentForm]="validatorForm"
    [heading]="'CONTRIBUTOR.RETURN-TERMINATE-CONTRIBUTOR'"
    [warningMessage]="
      isReturnToAdmin ? 'CORE.INFO.RETURN-TO-ADMIN-TRANSACTION-INFO' : 'CORE.INFO.RETURN-TO-VALIDATOR-TRANSACTION-INFO'
    "
    [returnReasonList$]="returnReasonList$"
    (cancelEvent)="hideModal()"
    (returnEvent)="handleWorkflowEvents(2)"
  >
  </frm-return-template-dc>
</ng-template>
