<!--
  ~ Copyright GOSI. All Rights Reserved.
  ~  This software is the proprietary information of GOSI.
  ~  Use is subject to license terms.
  -->
<div class="row" *ngIf="listOfValues && listOfValues.length">
  <div class="col-md-12 table-view overflow-auto w-100">
    <table class="table table-borderless">
      <thead class="thead-light">
        <tr>
          <th *ngIf="actionType"></th>
          <th *ngFor="let eachHeading of tableHeadingAndParams">{{ eachHeading?.heading | translate | uppercase }}</th>
          <th *ngIf="!actionType">{{ 'BENEFITS.ELIGIBLITY-STATUS' | translate | uppercase }}</th>
        </tr>
      </thead>
      <ng-container *ngFor="let value of listOfValues; let i = index">
        <tbody [ngClass]="{ 'border-black': value.showBorder }" *ngIf="value.actionType !== ActionType.REMOVE">
          <tr class="data-row" [ngClass]="getClass(value, lang)">
            <td *ngIf="actionType && checkListValue.controls[i]">
              <gosi-input-checkbox-dc
                id="checkBox{{ i }}"
                (select)="checkStatusEditable(i)"
                name="checkBox{{ i }}"
                [control]="checkListValue.controls[i]?.get('checkBoxFlag')"
              >
              </gosi-input-checkbox-dc>
            </td>
            <td *ngFor="let eachHeading of tableHeadingAndParams">
              <div *ngIf="eachHeading.parameterName === 'name'; else heirStatuss">
                <div>{{ value[eachHeading?.parameterName] | nameToString: true }}</div>
                <div class="d-block nin-text" *ngIf="value?.identity?.length > 0">
                  <span *ngIf="value?.identity[0]?.newNin">{{ 'BENEFITS.NIN-ID' | translate }} :</span>
                  <span *ngIf="value?.identity[0]?.iqamaNo">{{ 'BENEFITS.IQAMA-NUMBER' | translate }} :</span>
                  <span *ngIf="value?.identity[0]?.idType === 'GCCID'">{{ 'BENEFITS.GCCID' | translate }} :</span>
                  <span class="value"> {{ checkIfAgeOrId(value, 'id') }}</span>
                </div>
              </div>
              <ng-template #heirStatuss>
                <ng-container *ngIf="eachHeading.parameterName === 'heirStatus'; else notName">
                  <span *ngIf="value.newHeirStatus; else oldHeirStatus">
                    {{ value.newHeirStatus | bilingualText }}
                  </span>
                  <ng-template #oldHeirStatus>
                    {{ value.heirStatus | bilingualText }}
                  </ng-template>
                </ng-container>
              </ng-template>
              <ng-template #notName>
                {{ checkIfAgeOrId(value, eachHeading.parameterName) | bilingualText }}
                <div class="value">
                  {{ displayHijiriDOB(value, eachHeading.parameterName) | bilingualText }}
                </div>
              </ng-template>
            </td>
            <td *ngIf="!actionType">
              <div *ngIf="value.showMandatoryDetails && !isModifyPage; else hasMandatoryDetailsOrModifyPage">
                <fa-icon class="warning-icon" size="md" icon="exclamation-triangle"></fa-icon>
                <a class="view-link" (click)="editButtonClick(i)">
                  <span>{{ 'BENEFITS.VALIDATE-EVENT-TEXT' | translate }}</span> </a
                >&nbsp;
                <!-- Delete button added as a part of Defect 486543 -->
                <fa-icon (click)="deleteButtonClick(i)" size="lg" class="delete-icon" [icon]="['far', 'trash-alt']">
                </fa-icon>
              </div>
              <ng-template #hasMandatoryDetailsOrModifyPage>
                <div class="action-icon">
                  <!-- *ngIf="
                    value.newlyAdded ||
                    value.showGreenBorder ||
                    (value.personId &&
                      !value.showGreenBorder &&
                      value.statusAfterValidation?.english === notEligibleText.english)
                  " -->
                  <fa-icon
                    *ngIf="value.statusAfterValidation"
                    [ngClass]="
                      value?.statusAfterValidation?.english === benefitValues?.eligible ||
                      value?.statusAfterValidation?.english === benefitValues?.eligibleBackdated
                        ? 'eligible-icon'
                        : 'warning-icon'
                    "
                    [icon]="
                      value?.statusAfterValidation?.english === benefitValues?.eligible ||
                      value?.statusAfterValidation?.english === benefitValues?.eligibleBackdated
                        ? 'check-circle'
                        : 'exclamation-triangle'
                    "
                    size="md"
                  ></fa-icon>
                  <span
                    [ngClass]="
                      value?.statusAfterValidation?.english === benefitValues?.eligible ||
                      value?.statusAfterValidation?.english === benefitValues?.eligibleBackdated
                        ? 'eligible-text'
                        : 'warning-text'
                    "
                    >{{ value.statusAfterValidation | bilingualText }}
                  </span>

                  <a
                    class="view-link"
                    *ngIf="
                      isModifyPage
                        ? value?.statusAfterValidation?.english === benefitValues?.noneligible &&
                          value?.validateApiResponse
                        : value?.statusAfterValidation?.english === benefitValues?.noneligible
                    "
                    routerLinkActive="active"
                    (click)="showIneligibilityReasons(value)"
                  >
                    <span>{{ 'BENEFITS.SHOW-REASONS' | translate }}</span>
                  </a>
                  <fa-icon
                    size="lg"
                    [ngClass]="{
                      'd-none':
                        value.heirStatus?.english === status.DEAD &&
                        value.dependentSource === benefitValues.nic &&
                        value.actionType !== ActionType.MODIFY
                    }"
                    (click)="editButtonClick(i)"
                    class="pl-3 pr-3 pencil-alt"
                    [icon]="['fas', 'pencil-alt']"
                  >
                  </fa-icon>
                  <!--Story 500972 delete button required for NIC/MOJ -->
                  <!--In modify screen, delete button not required for manually added from request screen -->
                  <!--                  *ngIf="!(value.dependentSource === benefitValues.gosi && !value.actionType) && value.actionType !== ActionType.MODIFY"-->

                  <fa-icon
                    *ngIf="value.actionType === ActionType.ADD"
                    (click)="deleteButtonClick(i)"
                    size="lg"
                    class="delete-icon"
                    [icon]="['far', 'trash-alt']"
                  >
                  </fa-icon>
                </div>
              </ng-template>
            </td>
            <!-- </tr>
          <tr *ngIf="value.editable && !actionType" class="bg-none"> -->
            <td
              class="full-width-td white-bg"
              [attr.colspan]="tableHeadingAndParams.length + 1"
              *ngIf="value.editable && !actionType"
            >
              <!-- <bnt-dependent-modify-status-dc
                *ngIf="isModifyPage && !value.newlyAdded && value.actionType !== ActionType.ADD; else addDependent"
                [dependentDetail]="value"
                [reasonsList]="reasonsList"
                [systemParameter]="systemParameter"
                [dependentStatusResp]="dependentStatusResp"
                [systemRunDate]="systemRunDate"
                (cancelEdit)="editButtonClick(i)"
                (saveDependent)="updateDependent($event)"
                (validateDependentModifyReason)="validateDependentModifyReason($event)"
                (statusDate)="updateStatusDate($event)"
              >
              </bnt-dependent-modify-status-dc> -->
              <bnt-add-modify-dependent-dc
                *ngIf="isModifyPage && !value.newlyAdded && value.actionType !== ActionType.ADD; else addDependent"
                [lang]="lang"
                [isValidator]="isValidator"
                [addedEvent]="addedEvent"
                [isModifyPage]="isModifyPage"
                [dependentDetails]="value"
                [annuityResponse]="annuityResponse"
                [benefitRequestId]="benefitRequestId"
                [benefitStartDate]="benefitStartDate"
                [validateApiResponse]="validateApiResponse"
                [eligibilityStartDate]="eligibilityStartDate"
                [parentForm]="parentForm"
                [events]="events"
                [isDraft]="isDraft"
                (getEvents)="getEvents.emit($event)"
                (addEvent)="addEvent.emit($event)"
                (cancelEdit)="editButtonClick(i)"
                (saveDependent)="updateDependent($event)"
                (validateDependent)="validateDependent($event)"
              ></bnt-add-modify-dependent-dc>
              <ng-template #addDependent>
                <bnt-dependent-add-edit-dc
                  *ngIf="!value.nonSaudiDependentAdded; else nonSaudiAddDependent"
                  #addDependentChildComp
                  [events]="events"
                  [requestDateChangedByValidator]="requestDateChangedByValidator"
                  [isModifyPage]="isModifyPage"
                  [systemRunDate]="systemRunDate"
                  [isLumpsum]="isLumpsum"
                  [contributorDetails]="contributorDetails"
                  [update]="true"
                  [isValidator]="isValidator"
                  [validateApiResponse]="validateApiResponse"
                  [addedEvent]="addedEvent"
                  [lang]="lang"
                  [benefitRequestId]="benefitRequestId"
                  [eligibilityStartDate]="eligibilityStartDate"
                  [parentForm]="parentForm"
                  [benefitStartDate]="benefitStartDate"
                  [dependentDetails]="value"
                  [systemParameter]="systemParameter"
                  [annuityRelationShipList]="annuityRelationShip$ | async"
                  [maritalStatusList]="maritalStatus$ | async"
                  [heirStatusList]="heirStatus$ | async"
                  [heirStatusArr]="heirStatusArr"
                  [ageInNewLaw]="ageInNewLaw"
                  [isDraft]="isDraft"
                  (isThisAgeInNewLaw)="isThisAgeInNewLaw.emit($event)"
                  (saveDependent)="updateDependent($event)"
                  (validateDependent)="validateDependent($event)"
                  (reset)="reset()"
                  [disableSave]="disableSave"
                  (cancelEdit)="editButtonClick(i)"
                  (addEvent)="addEventPopup($event)"
                >
                </bnt-dependent-add-edit-dc>
                <ng-template #nonSaudiAddDependent>
                  <bnt-dependent-add-dc
                    [events]="events"
                    [isModifyPage]="isModifyPage"
                    [systemRunDate]="systemRunDate"
                    [isLumpsum]="isLumpsum"
                    [contributorDetails]="contributorDetails"
                    [update]="true"
                    [validateApiResponse]="validateApiResponse"
                    [addedEvent]="addedEvent"
                    [lang]="lang"
                    [eligibilityStartDate]="eligibilityStartDate"
                    [parentForm]="parentForm"
                    [benefitStartDate]="benefitStartDate"
                    [dependentDetails]="value"
                    [genderList]="genderList"
                    [systemParameter]="systemParameter"
                    [annuityRelationShipList]="annuityRelationShip$ | async"
                    [maritalStatusList]="maritalStatus$ | async"
                    [heirStatusList]="heirStatus$ | async"
                    [heirStatusArr]="heirStatusArr"
                    [ageInNewLaw]="ageInNewLaw"
                    [calcHijiriAgeInMonths]="calcHijiriAgeInMonths"
                    [isDraft]="isDraft"
                    (isThisAgeInNewLaw)="isThisAgeInNewLaw.emit($event)"
                    (saveDependent)="updateDependent($event)"
                    (validateDependent)="validateDependent($event)"
                    (reset)="reset()"
                    (cancelEdit)="editButtonClick(i)"
                    (addEvent)="addEventPopup($event)"
                    (getRelationshipListByGender)="getRelationshipListByGender.emit($event)"
                  >
                  </bnt-dependent-add-dc>
                </ng-template>
              </ng-template>
            </td>
          </tr>
          <!--Hold restart waive stop status change-->
          <tr *ngIf="value.editable && actionType && checkListValue.controls[i]" class="bg-none">
            <td [attr.colspan]="tableHeadingAndParams.length + 1" class="dotted-line">
              <bnt-modify-action-dc
                [reasonsList]="reasonsList"
                [heirActionType]="actionType"
                [minDateForCalendar]="
                  checkListValue.controls[i]?.get('eachPerson')?.get('statusChange.statusDate')?.value
                "
                [systemRunDate]="systemRunDate"
                [heirDetail]="value"
                [heirDetails]="listOfValues"
                [annuityResponse]="annuityResponse"
                [parentForm]="checkListValue.controls[i]?.get('eachPerson')"
                [isDraft]="isDraft"
                [listYesNo$]="listYesNo$"
              >
              </bnt-modify-action-dc>
            </td>
          </tr>
        </tbody>
      </ng-container>
    </table>
  </div>
</div>
